<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>⚙️ Heyns Admin Portal - FAA.ZONE™</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        /* Base styles for the "Interstellar" theme */
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e); /* Deep space gradient */
            color: #E0E0E0; /* Light gray for general text */
            line-height: 1.6;
            min-height: 100vh; /* Ensure full viewport height */
            display: flex;
            flex-direction: column;
        }

        /* Header Styling - Adopted from FAA™ Global Ecosystem Dashboard */
        header {
            background-color: rgba(30, 30, 45, 0.9); /* Slightly transparent dark header */
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4); /* Deeper shadow */
            position: sticky;
            top: 0;
            z-index: 50;
            backdrop-filter: blur(5px); /* Subtle blur effect */
            border-bottom: 1px solid rgba(70, 70, 90, 0.5); /* Subtle bottom border */
            padding-top: 1.5rem; /* Equivalent to p-6/2 */
            padding-bottom: 1.5rem;
            padding-left: 2.5rem; /* Equivalent to lg:p-10/2 */
            padding-right: 2.5rem;
        }
        header a {
            transition: all 0.3s ease-in-out;
            color: #C0C0C0; /* Lighter gray for links */
            padding: 0.6rem 1rem;
            border-radius: 0.5rem; /* More rounded */
            font-weight: 500;
        }
        header a:hover {
            background-color: rgba(60, 60, 90, 0.7); /* Darker hover background */
            color: #93C5FD; /* Light blue accent on hover */
            transform: translateY(-2px); /* Subtle lift effect */
        }
        header a.text-2xl { /* Logo specific styling */
            color: #A78BFA; /* Purple accent for logo */
            font-weight: 800;
        }

        /* Call-to-action Button (cta-button) */
        .cta-button {
            background: linear-gradient(45deg, #6B46C1, #8B5CF6); /* Purple gradient */
            color: white;
            padding: 0.85rem 1.8rem; /* Slightly larger padding */
            border-radius: 0.75rem; /* More rounded */
            font-weight: 700; /* Bolder */
            transition: all 0.4s ease;
            box-shadow: 0 6px 15px rgba(139, 92, 246, 0.4); /* Glow effect */
            position: relative;
            overflow: hidden;
            border: none;
            letter-spacing: 0.05em; /* Slightly spaced out text */
            min-width: 150px; /* Ensure consistent button width */
            text-align: center;
        }
        .cta-button:hover {
            background: linear-gradient(45deg, #7C5BC7, #9B6EF9); /* Slightly lighter gradient on hover */
            transform: translateY(-3px) scale(1.02); /* More pronounced lift and slight scale */
            box-shadow: 0 10px 30px rgba(139, 92, 246, 0.6); /* Enhanced glow */
        }
        .cta-button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0%;
            height: 0%;
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            transition: all 0.7s ease-out;
            transform: translate(-50%, -50%);
            opacity: 0;
        }
        .cta-button:hover::before {
            width: 300%;
            height: 300%;
            opacity: 1;
        }

        /* Product Card Styling (adapted for dark theme) */
        .product-card {
            background-color: rgba(25, 25, 40, 0.9); /* Dark card background */
            border-radius: 1rem; /* More rounded */
            border: 1px solid rgba(70, 70, 90, 0.5); /* Subtle border */
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.5); /* Deeper, softer shadow */
            transition: all 0.4s ease-in-out;
            padding: 2rem; /* Consistent with dashboard p-8 for cards */
            display: flex;
            flex-direction: column;
            /* text-align: center; -- Removed to allow text-left as default or from inner elements */
            height: 500px; /* Adjusted height for optimal content fit */
            justify-content: space-between; /* Pushes buttons to bottom */
            position: relative;
            z-index: 2;
        }
        /* Override alignment for content within product card for text-left as in products.html */
        .product-card > div {
            text-align: left; /* Ensure inner content aligns left */
            align-items: flex-start;
        }

        .product-card:hover {
            transform: translateY(-8px) scale(1.01); /* More distinct lift and scale */
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.7); /* Even deeper shadow on hover */
            border-color: #A78BFA; /* Purple border on hover */
        }
        .product-card.featured {
            border-color: #A78BFA; /* Purple for featured border */
            box-shadow: 0 15px 40px rgba(167, 139, 250, 0.4); /* Featured glow */
        }
        .product-card h3 {
            color: #A78BFA; /* Purple for card titles */
        }
        .product-card p.text-gray-400 { /* Changed from text-gray-500 to text-gray-400 for consistency with new styling */
            color: #B0B0B0; /* Lighter gray for descriptive text */
        }
        .price-display {
            color: #93C5FD; /* Light blue for prices */
        }
        .feature-list {
            list-style: none;
            padding: 0;
            margin: 0;
            text-align: left;
            width: 100%;
            margin-bottom: 1.5rem; /* Consistent spacing, allows flex-grow to work */
            flex-grow: 1; /* Allows list to take available space */
        }
        .feature-list li {
            margin-bottom: 0.6rem; /* Adjusted spacing */
            display: flex;
            align-items: flex-start; /* Align icon with text top */
            color: #C0C0C0; /* Light gray for features */
            font-size: 0.95rem; /* Slightly larger text */
        }
        .feature-list li svg {
            margin-right: 0.75rem;
            color: #34D399; /* Green accent for checkmarks */
            flex-shrink: 0; /* Prevent icon from shrinking */
            width: 24px; /* Larger icon */
            height: 24px;
        }

        /* Admin specific styles (dark theme adaptation) */
        /* Adjusted padding and margin for consistent "waterlevel blocks" */
        .admin-main-header {
            background-color: rgba(30, 30, 45, 0.9);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
            padding: 2.5rem; /* Adopted from dashboard p-10 */
            border-radius: 1rem;
            margin-bottom: 2.5rem; /* Adopted from dashboard gap-8 for sections */
            border-top: 8px solid #93C5FD; /* Light blue accent bar */
            color: #E0E0E0;
        }
        .admin-main-header h1 {
            color: #93C5FD; /* Light blue for main heading */
            font-weight: 900;
        }
        .admin-main-header p {
            color: #B0B0B0;
        }

        .admin-nav-scroll {
            background-color: rgba(30, 30, 45, 0.9);
            border-radius: 1rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
            padding: 1.2rem 2.5rem; /* Adjusted for p-10 from dashboard header */
            margin-bottom: 2.5rem; /* Adopted from dashboard gap-8 for sections */
            overflow-x: auto;
            white-space: nowrap;
            border: 1px solid rgba(70, 70, 90, 0.5);
        }
        .admin-nav-scroll a {
            @apply px-4 py-2 rounded-lg text-gray-300 hover:bg-gray-700 font-medium; /* Darker hover, lighter text */
            transition: all 0.3s ease-in-out;
        }
        .admin-nav-scroll a.active {
            @apply bg-indigo-800 text-indigo-200 font-semibold; /* Darker indigo for active */
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.3); /* Inner shadow for active state */
        }

        .admin-panel-card {
            background-color: rgba(25, 25, 40, 0.9);
            border-radius: 1rem;
            border: 1px solid rgba(70, 70, 90, 0.5);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.5);
            padding: 2.5rem; /* Adopted from dashboard p-10 */
            margin-bottom: 2.5rem; /* Adopted from dashboard gap-8 for sections */
            color: #E0E0E0;
        }
        .admin-panel-card h2 {
            color: #93C5FD; /* Light blue for section titles */
        }
        .admin-panel-card h3 {
            color: #A78BFA; /* Purple for sub-titles */
        }
        .admin-panel-card p.text-gray-600 {
            color: #B0B0B0;
        }

        /* Form elements (dark theme) */
        label {
            color: #C0C0C0;
        }
        input, select {
            background-color: rgba(45, 45, 70, 0.8);
            border: 1px solid rgba(80, 80, 100, 0.6);
            color: #E0E0E0;
            padding: 0.75rem;
            border-radius: 0.5rem;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        input::placeholder {
            color: #A0A0A0;
        }
        input:focus, select:focus {
            border-color: #93C5FD;
            outline: none;
            box-shadow: 0 0 0 3px rgba(147, 197, 253, 0.5); /* Focus glow */
        }

        /* Table Styling (dark theme) */
        .table-header-style {
            background-color: rgba(45, 45, 70, 0.8);
            color: #A78BFA; /* Purple for header text */
            font-weight: 700;
            border-bottom: 2px solid rgba(100, 100, 120, 0.5);
        }
        .table-row-style {
            border-bottom: 1px solid rgba(70, 70, 90, 0.5);
        }
        .table-row-style:last-child {
            border-bottom: none;
        }
        .table-row-style:hover {
            background-color: rgba(45, 45, 70, 0.5); /* Subtle hover for rows */
        }
        .table-cell-padding {
            padding: 1rem; /* More padding */
            color: #E0E0E0;
        }
        .table-cell-padding button {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-size: 0.85rem;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }
        .table-cell-padding button.bg-blue-500 { /* Inspect button */
            background-color: #60A5FA; /* Brighter blue */
            color: #1F2937;
        }
        .table-cell-padding button.bg-blue-500:hover {
            background-color: #3B82F6;
            transform: translateY(-1px);
        }
        .table-cell-padding button.bg-green-500 { /* Deploy button */
            background: linear-gradient(90deg, #10B981, #059669); /* Green gradient */
            color: white;
        }
        .table-cell-padding button.bg-green-500:hover {
            background: linear-gradient(90deg, #059669, #047857);
            transform: translateY(-1px);
        }

        /* Metrics Cards (dark theme) - Adjusted padding to match dashboard */
        .metric-card { /* New class for reusability */
            background-color: rgba(35, 35, 55, 0.9); /* Dark background */
            border: 1px solid rgba(70, 70, 90, 0.5);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
            border-radius: 0.75rem;
            padding: 1.5rem; /* Consistent with dashboard metric cards */
            color: #E0E0E0;
        }
        .metric-card h3 {
            color: #93C5FD; /* Light blue for metric titles */
        }
        .metric-card p {
            color: #A78BFA; /* Purple for metric values */
        }


        /* Chart container - Adjusted padding to match dashboard */
        .w-full.bg-white.p-6.rounded-lg.shadow-inner.border.border-gray-200.h-96 {
            background-color: rgba(25, 25, 40, 0.9);
            border: 1px solid rgba(70, 70, 90, 0.5);
            box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.3); /* Inner shadow */
            color: #E0E0E0;
            padding: 2.5rem; /* Consistent with dashboard p-10 */
        }
        .w-full.bg-white.p-6.rounded-lg.shadow-inner.border.border-gray-200.h-96 h3 {
            color: #93C5FD;
        }

        /* Sector View specific elements (currency converter and dropdown) */
        .currency-converter-container { /* New class to control this specific block */
            background-color: rgba(45, 45, 70, 0.8); /* Darker background for this specific block */
            border: 1px solid rgba(80, 80, 100, 0.6);
            color: #D0D0D0; /* Light text for general content in this block */
            border-radius: 0.75rem; /* Consistent rounding */
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3); /* Subtle shadow */
            padding: 1.5rem; /* Consistent with dashboard p-6 for smaller blocks */
        }
        .currency-converter-container label {
            color: #D0D0D0; /* Ensure label text is also light */
        }
        /* Specific styling for the currency select element itself within the admin portal */
        #sector-currency-select {
            background-color: rgba(60, 60, 90, 0.9); /* Even darker background for the select dropdown */
            border: 1px solid rgba(100, 100, 120, 0.7);
            color: #E0E0E0; /* Light text for the selected option */
            min-width: 80px; /* Ensure dropdown has enough width */
        }
        #sector-currency-select option {
            background-color: rgba(60, 60, 90, 0.9); /* Dark background for options */
            color: #E0E0E0; /* Light text for options */
        }

        /* Toggle switch for monthly/annual */
        .toggle-switch {
            position: relative;
            display: inline-flex; /* Use inline-flex for better control */
            align-items: center;
            justify-content: space-between; /* Space out text labels */
            width: 180px; /* Increased width to prevent overlap */
            height: 34px;
            margin: 10px 0;
            border-radius: 17px;
            background-color: rgba(70, 70, 90, 0.8); /* Dark background */
            cursor: pointer;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.3), 0 1px 0 rgba(255,255,255,0.05);
            padding: 0 8px; /* Added padding here to control text spacing */
        }
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: transparent;
            -webkit-transition: .4s;
            transition: .4s;
            border-radius: 17px;
            display: flex; /* Use flex for text alignment */
            align-items: center;
            justify-content: space-between; /* Distribute text labels */
            font-size: 0.85rem;
            font-weight: 600;
            color: #C0C0C0;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 85px; /* Adjusted width for slider tab */
            left: 4px;
            bottom: 4px;
            background: linear-gradient(45deg, #60A5FA, #93C5FD); /* Blue gradient for toggle handle */
            -webkit-transition: .4s;
            transition: .4s;
            border-radius: 13px; /* Half of height for rounded shape */
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
        input:checked + .slider {
            background-color: transparent;
        }
        input:focus + .slider {
            box-shadow: 0 0 1px #93C5FD;
        }
        /* Adjusted translation for wider switch */
        input:checked + .slider:before {
            -webkit-transform: translateX(88px);
            -ms-transform: translateX(88px);
            transform: translateX(88px);
        }
        .slider span {
            z-index: 1; /* Ensure text is above slider */
            user-select: none;
            color: #C0C0C0; /* Default text color */
            transition: color 0.3s ease;
            flex-shrink: 0; /* Prevent text from shrinking */
        }
        /* Monthly text is active when unchecked, annual when checked */
        .slider .annual-text {
            margin-right: 5px; /* Adjust spacing between text labels */
        }
        .slider .monthly-text {
            margin-left: 5px; /* Adjust spacing between text labels */
        }
        /* Color logic for toggle text based on checked state to match screenshot */
        input:checked + .slider .annual-text { /* When checked, annual is active (white) */
            color: white;
        }
        input:checked + .slider .monthly-text { /* When checked, monthly is inactive (gray) */
            color: #C0C0C0;
        }
        input:not(:checked) + .slider .annual-text { /* When not checked, annual is inactive (gray) */
            color: #C0C0C0;
        }
        input:not(:checked) + .slider .monthly-text { /* When not checked, monthly is active (white) */
            color: white;
        }


        /* Footer Styling */
        footer {
            background-color: rgba(20, 20, 35, 0.9);
            border-top: 1px solid rgba(70, 70, 90, 0.5);
            color: #A0A0A0; /* Slightly darker gray for footer text */
            margin-top: auto; /* Push footer to the bottom */
        }
        .footer-logo-text {
            color: #A78BFA;
            font-weight: 800;
        }
        footer a {
            color: #C0C0C0;
            transition: color 0.3s ease;
        }
        footer a:hover {
            color: #93C5FD;
        }

        /* Specific classes for status messages */
        #adminStatus.text-sm.italic { /* Simplified to apply to base status */
            color: #B0B0B0; /* Light gray for general status */
        }
        #adminStatus.text-red-500 {
            color: #F87171; /* Lighter red for errors */
        }
        #adminStatus.text-green-500 {
            color: #6EE7B7; /* Lighter green for success */
        }
        
        /* Clear data button */
        button.text-sm.text-red-600 {
            color: #EF4444; /* Brighter red for action */
        }
        button.text-sm.text-red-600:hover {
            color: #DC2626;
        }

        /* Adjust Chart.js colors for dark theme */
        .chartjs-render-monitor {
            background-color: transparent !important; /* Ensure canvas background is transparent */
        }
        /* Added for PayPal Error Message Display */
        .paypal-message { /* Unified class for both error and success */
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            z-index: 1000;
            font-size: 0.9rem;
            max-width: 300px;
            text-align: center;
            animation: fadeInOut 5s forwards;
        }
        /* Specific styling for error messages */
        .paypal-message.error {
            background-color: #ffdddd;
            color: #d8000c;
        }
        /* Specific styling for success messages */
        .paypal-message.success {
            background-color: #d4edda;
            color: #155724;
        }
        /* Specific styling for info messages */
        .paypal-message.info {
            background-color: #d1ecf1; /* Light blue */
            color: #0c5460; /* Darker blue */
        }


        @keyframes fadeInOut {
            0% { opacity: 0; transform: translateY(-20px); }
            10% { opacity: 1; transform: translateY(0); }
            90% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(-20px); }
        }

        /* Styles for brand buttons (new) */
        .brand-button {
            display: inline-flex;
            align-items: center;
            padding: 0.75rem 1.5rem;
            margin: 0.5rem;
            background-color: rgba(60, 60, 90, 0.7);
            color: #A78BFA; /* Purple text */
            border: 1px solid rgba(139, 92, 246, 0.5); /* Purple border */
            border-radius: 9999px; /* Pill shape */
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            flex-grow: 1; /* Allow buttons to grow and fill space */
            justify-content: center; /* Center text in button */
            min-width: 120px; /* Ensure a minimum width for buttons */
        }
        .brand-button:hover {
            background-color: rgba(139, 92, 246, 0.2); /* Lighter purple background on hover */
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
        }
        .brand-button.active {
            background-color: #A78BFA; /* Solid purple when active */
            color: white;
            box-shadow: 0 4px 10px rgba(139, 92, 246, 0.6);
            transform: translateY(-1px);
        }
        .brand-button span {
            margin-right: 0.5rem; /* Space between glyph and text */
        }

        /* Styles for snapshot boxes */
        .snapshot-box {
            background-color: rgba(25, 25, 40, 0.9);
            border-radius: 1rem;
            border: 1px solid rgba(70, 70, 90, 0.5);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.5);
            padding: 2.5rem;
            margin-bottom: 2.5rem;
            color: #E0E0E0;
        }
        .snapshot-box h3 {
            color: #93C5FD;
            font-weight: 700;
            margin-bottom: 1.5rem;
        }
        .snapshot-box h4 {
            color: #A78BFA;
            font-weight: 600;
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
        }
        .snapshot-box ul {
            list-style: none;
            padding: 0;
        }
        .snapshot-box ul li {
            margin-bottom: 0.4rem;
            font-size: 0.95rem;
            color: #C0C0C0;
        }
        .snapshot-box .close-button {
            float: right;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #F87171; /* Red close icon */
            cursor: pointer;
            transition: color 0.3s ease;
        }
        .snapshot-box .close-button:hover {
            color: #EF4444;
        }

        /* Specific styling for the PayPal button container */
        .paypal-button-container {
            min-height: 50px; /* Ensure space for the button */
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 1rem; /* Space from features */
        }
    </style>
</head>
<body class="antialiased">

    <header class="py-4 px-8">
        <div class="container mx-auto flex flex-col md:flex-row justify-between items-center space-y-2 md:space-y-0">
            <a href="index.html" class="text-2xl font-bold">🦍 FAA.ZONE™</a>
            <nav class="flex flex-wrap justify-center md:justify-end items-center space-x-4 md:space-x-6 text-sm">
                <a href="/">Home</a>
                <a href="/pricing">Pricing & Plans 💰</a>
                <a href="/products">Products</a>
                <a href="/about">About Us ℹ️</a>
                <a href="/contact">Contact Us 📧</a>
            </nav>
        </div>
    </header>

    <main class="main-content p-6 md:p-12 flex-grow">
        <header class="admin-main-header">
            <h1 class="text-3xl font-extrabold">⚙️ Heyns Admin Portal</h1>
            <p class="text-sm mt-1">Corebrands management & AI logic deployment center.</p>
        </header>

        <nav class="admin-nav-scroll flex flex-wrap gap-x-4 gap-y-2 mb-8">
            <a href="#" class="admin-nav-link" data-section="add-brand-section">➕ Add Brand & Subnodes</a>
            <a href="#" class="admin-nav-link" data-section="global-index-section">📊 Global Index</a>
            <a href="#" class="admin-nav-link" data-section="metrics-section">📈 Real-Time Metrics</a>
            <a href="#" class="admin-nav-link" data-section="sector-view-section">🔍 Sector View</a>
        </nav>


        <section id="add-brand-section" class="admin-panel-card space-y-8">
            <h2 class="text-2xl font-bold">Add New Brand & Subnodes</h2>
            <p>Manually add new core brands and their associated subnodes to the FAA.ZONE ecosystem. This updates client-side data and pushes to backend.</p>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                <div>
                    <label class="text-sm block font-medium mb-1">📂 Sector</label>
                    <select id="sectorSelect" class="w-full border rounded p-2"></select>
                </div>
                <div>
                    <label class="text-sm block font-medium mb-1">🏷 Brand Name</label>
                    <input id="brandInput" class="w-full border rounded p-2" placeholder="e.g. OmniCastX">
                </div>
                <div>
                    <label class="text-sm block font-medium mb-1">📌 Subnodes (comma-separated)</label>
                    <input id="subnodesInput" class="w-full border rounded p-2" placeholder="e.g. VaultDrop, QRClaim">
                </div>
                <div class="flex items-end">
                    <button id="addBrandBtn" class="cta-button w-full">
                        ➕ Add Brand
                    </button>
                </div>
            </div>
            <p id="adminStatus" class="text-sm italic mt-4">Ready to receive input.</p>
            <div class="mt-4">
                <button id="clearAdminDataBtn" class="text-sm text-red-600 underline hover:text-red-800 transition">
                    🗑 Clear Locally Added Admin Data (Client-Side)
                </button>
            </div>
        </section>

        <section id="global-index-section" class="admin-panel-card hidden">
            <h2 class="text-2xl font-bold mb-4">📊 FAA.ZONE Global Index — Core Brands Overview</h2>
            <p class="mb-4">A comprehensive list of all core brands within the FAA.ZONE ecosystem, including backend-synced data and client-side additions.</p>
            <div class="overflow-x-auto snapshot-box">
                <table class="min-w-full text-sm text-left">
                    <thead class="table-header-style">
                        <tr>
                            <th class="px-4 py-2">Glyph</th>
                            <th class="px-4 py-2">Sector</th>
                            <th class="px-4 py-2">Core Brands</th>
                            <th class="px-4 py-2">Total Nodes</th>
                            <th class="px-4 py-2">Monthly Fee</th>
                            <th class="px-4 py-2">Annual Fee</th>
                            <th class="px-4 py-2">Payout Tier</th>
                            <th class="px-4 py-2">Region</th>
                            <th class="px-4 py-2">Inspect</th>
                            <th class="px-4 py-2">Deploy</th>
                        </tr>
                    </thead>
                    <tbody class="text-gray-200" id="faaZoneIndexTableBody"></tbody>
                </table>
            </div>
        </section>

        <section id="metrics-section" class="admin-panel-card hidden">
            <h2 class="text-2xl font-bold mb-6">📈 Real-Time FAA Pulse Metrics</h2>
            <p class="mb-8">Live monitoring of key operational metrics across the ecosystem.</p>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 mb-10">
                <div class="metric-card">
                    <h3 class="font-semibold">🧠 Active Nodes</h3>
                    <p class="text-3xl font-bold mt-2" id="activeNodesCount">0</p>
                </div>
                <div class="metric-card">
                    <h3 class="font-semibold">🔐 Licenses Active</h3>
                    <p class="text-3xl font-bold mt-2" id="licensesActiveCount">0</p>
                </div>
                <div class="metric-card">
                    <h3 class="font-semibold">💾 Vault Deployments</h3>
                    <p class="text-3xl font-bold mt-2" id="vaultDeploymentsCount">0</p>
                </div>
                <div class="metric-card">
                    <h3 class="font-semibold">📥 Sync Logs</h3>
                    <p class="text-3xl font-bold mt-2" id="syncLogsCount">0</p>
                </div>
                <div class="metric-card">
                    <h3 class="font-semibold">Audit Runs</h3>
                    <p class="text-3xl font-bold mt-2" id="auditsRunningCount">0</p>
                </div>
                <div class="metric-card">
                    <h3 class="font-semibold">Signal Zones</h3>
                    <p class="text-3xl font-bold mt-2" id="signalZonesCount">0</p>
                </div>
                <div class="metric-card">
                    <h3 class="font-semibold">ScrollGrid Index</h3>
                    <p class="text-3xl font-bold mt-2" id="scrollGridIndexCount">0</p>
                </div>
            </div>
            <div class="w-full bg-white p-8 rounded-lg shadow-inner border h-96">
                <h3 class="text-xl font-bold mb-4">FAA Scroll Pulse Monitor</h3>
                <canvas id="pulseChart" class="w-full h-full"></canvas>
            </div>
        </section>

        <section id="sector-view-section" class="admin-panel-card hidden">
            <h2 class="text-2xl font-bold mb-6">🔍 Sector-Specific View & Snapshots</h2>
            <p class="mb-8">Select a sector to view and manage its brands and subnodes, presented with the chosen product card aesthetic.</p>

            <div class="mb-8 p-6 rounded-lg flex items-center justify-between mx-auto max-w-sm currency-converter-container">
                <label for="sector-currency-select" class="font-medium text-sm">Display prices in:</label>
                <select id="sector-currency-select" class="ml-4 p-2 border rounded-md text-sm">
                    <option value="ZAR">ZAR (R)</option>
                    <option value="USD">USD ($)</option>
                    <option value="EUR">EUR (€)</option>
                    <option value="GBP">GBP (£)</option>
                </select>
            </div>

            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 mb-10">
                <div class="col-span-full">
                    <label class="text-sm block font-medium mb-1">Select Sector:</label>
                    <select id="sectorViewSelect" class="w-full border rounded p-2"></select>
                </div>
            </div>
            
            <div id="dynamicSectorDashboard" class="space-y-10">
                <p class="text-gray-400 col-span-full text-center mt-10">Select a sector to view its detailed dashboard.</p>
            </div>
            <div id="brandDetailsContainer" class="mt-8"></div>
        </section>

    </main>

    <footer class="enhanced-footer text-center py-10 mt-16">
        <div class="container mx-auto px-6">
            <div class="flex flex-col sm:flex-row justify-between items-center space-y-4 sm:space-y-0">
                <div class="text-lg footer-logo-text">FAA.ZONE™</div>
                <p class="text-sm">ScrollGrid · PulseTrade Certified · TreatyMesh Validated</p>
                <div class="flex space-x-4">
                    <a href="#" class="text-gray-400 hover:text-white transition-colors">Privacy</a>
                    <a href="#" class="text-gray-400 hover:text-white transition-colors">Terms</a>
                    <a href="#" class="text-gray-400 hover:text-white transition-colors">Contact</a>
                </div>
            </div>
            <p class="text-xs mt-6">© 2025 Fruitful Holdings (Pty) Ltd. All rights reserved.</p>
        </div>
    </footer>

    <script src="https://www.paypal.com/sdk/js?client-id=P-07F980334R518562XNBHLNJY&currency=ZAR&vault=true&intent=subscription"></script>

    <script type="module">
        // --- Global Utility Function: showTemporaryMessage ---
        // Moved outside IIFE or explicitly attached to window for global access
        window.showTemporaryMessage = function(message, type = 'info') {
            let messageDiv = document.getElementById('paypalGlobalMessage');
            if (!messageDiv) {
                messageDiv = document.createElement('div');
                messageDiv.id = 'paypalGlobalMessage';
                messageDiv.className = 'paypal-message opacity-0 transition-opacity duration-300 ease-in-out'; // Use unified class
                document.body.appendChild(messageDiv);
            }
            messageDiv.textContent = message;
            messageDiv.classList.remove('error', 'success', 'info'); // Clear previous type classes
            
            switch (type) {
                case 'success':
                    messageDiv.classList.add('success');
                    break;
                case 'error':
                    messageDiv.classList.add('error');
                    break;
                case 'info':
                default:
                    messageDiv.classList.add('info');
                    break;
            }
            
            // Remove any existing fade-out animation to restart it
            messageDiv.style.animation = 'none';
            messageDiv.offsetHeight; /* trigger reflow */
            messageDiv.style.animation = null;

            messageDiv.classList.add('opacity-100');
            setTimeout(() => {
                messageDiv.classList.remove('opacity-100');
                setTimeout(() => { messageDiv.remove(); }, 300); // Remove after fade out
            }, 5000); // Message visible for 5 seconds
        };

        // --- GLOBAL DATA DEFINITIONS (MOVED OUTSIDE IIFE) ---
        // These variables need to be globally accessible for all functions.

        const API_KEY = "YOUR_EXCHANGE_RATE_API_KEY"; // IMPORTANT: Replace with your actual ExchangeRate-API Key
        const BASE_CURRENCY = "ZAR"; // Base currency for calculations
        let exchangeRates = {}; // To store fetched exchange rates

        // This flag helps prevent repeated warnings for the API key.
        let apiKeyWarningShown = false;

        // This object will store PayPal Plan IDs.
        // As per the user's request for a streamlined approach:
        // You should configure *ONE* generic PayPal Subscription Plan ID here that will be used as a base.
        // In a real backend, this single plan ID would be associated with logic to determine the specific
        // tier (Starter, Pro, Enterprise) and billing cycle (Monthly, Annual) based on the custom_id passed.
        // REPLACE "P-YOURGLOBALBASEPLANID" with a real, active PayPal Plan ID from your PayPal Developer Account.
        // For demonstration, all subscription attempts will use this single ID.
        let paypalPlanIDs = {
            "fruitful-global-base": "P-YOURGLOBALBASEPLANID",
            // The following specific plan IDs are kept as comments for reference,
            // but the system will primarily use "fruitful-global-base" for dynamic subscriptions.
            // If you had unique plans for each combination, you would uncomment and populate these.
            /*
            "agriculture-starter-monthly": "P-XXXXXXXXXXXXXXXX",
            "agriculture-starter-annual": "P-XXXXXXXXXXXXXXXX",
            "agriculture-pro-monthly": "P-XXXXXXXXXXXXXXXX",
            "agriculture-pro-annual": "P-XXXXXXXXXXXXXXXX",
            "agriculture-enterprise-monthly": "P-XXXXXXXXXXXXXXXX",
            "agriculture-enterprise-annual": "P-XXXXXXXXXXXXXXXX",
            "banking-starter-monthly": "P-XXXXXXXXXXXXXXXX",
            "banking-starter-annual": "P-XXXXXXXXXXXXXXXX",
            "banking-pro-monthly": "P-XXXXXXXXXXXXXXXX",
            "banking-pro-annual": "P-XXXXXXXXXXXXXXXX",
            "banking-enterprise-monthly": "P-XXXXXXXXXXXXXXXX",
            "banking-enterprise-annual": "P-XXXXXXXXXXXXXXXX",
            "logistics-starter-monthly": "P-XXXXXXXXXXXXXXXX",
            "logistics-starter-annual": "P-XXXXXXXXXXXXXXXX",
            "logistics-pro-monthly": "P-XXXXXXXXXXXXXXXX",
            "logistics-pro-annual": "P-XXXXXXXXXXXXXXXX",
            "logistics-enterprise-monthly": "P-XXXXXXXXXXXXXXXX",
            "logistics-enterprise-annual": "P-XXXXXXXXXXXXXXXX",
            "education-ip-starter-monthly": "P-XXXXXXXXXXXXXXXX",
            "education-ip-starter-annual": "P-XXXXXXXXXXXXXXXX",
            "education-ip-pro-monthly": "P-XXXXXXXXXXXXXXXX",
            "education-ip-pro-annual": "P-XXXXXXXXXXXXXXXX",
            "education-ip-enterprise-monthly": "P-XXXXXXXXXXXXXXXX",
            "education-ip-enterprise-annual": "P-XXXXXXXXXXXXXXXX"
            */
        };

        const sectorList = {
            "agriculture": "🌱 Agriculture & Biotech", "fsf": "🥦 Food, Soil & Farming",
            "banking": "🏦 Banking & Finance", "creative": "🖋️ Creative Tech",
            "logistics": "📦 Logistics & Packaging", "education-ip": "📚 Education & IP",
            "fashion": "✂ Fashion & Identity", "gaming": "🎮 Gaming & Simulation",
            "health": "🧠 Health & Hygiene", "housing": "🏗️ Housing & Infrastructure",
            "justice": "⚖ Justice & Ethics", "knowledge": "📖 Knowledge & Archives",
            "micromesh": "☰ Micro-Mesh Logistics", "media": "🎬 Motion, Media & Sonic",
            "nutrition": "✿ Nutrition & Food Chain", "ai-logic": "🧠 AI, Logic & Grid", 
            "packaging": "📦 Packaging & Materials", "quantum": "✴️ Quantum Protocols",
            "ritual": "☯ Ritual & Culture", "saas": "🔑 SaaS & Licensing",
            "trade": "🧺 Trade Systems", "utilities": "🔋 Utilities & Energy",
            "voice": "🎙️ Voice & Audio", "webless": "📡 Webless Tech & Nodes",
            "nft": "🔁 NFT & Ownership", "education-youth": "🎓 Education & Youth",
            "zerowaste": "♻️ Zero Waste", "professional": "🧾 Professional Services",
            "payroll-mining": "🪙 Payroll Mining & Accounting", "mining": "⛏️ Mining & Resources", 
            "wildlife": "🦁 Wildlife & Habitat",
            "admin-panel": "⚙️ Admin Panel" 
        };

        // Static data for FAA Zone Index, mimicking backend data structure for sectors
        // This is simplified; your backend would likely provide more granular data
        const FAA_ZONE_INDEX_SUMMARY_DATA = {
            "agriculture": {
                glyph: "🌱", monthlyFee: 1000, annualFee: 10200, payoutTier: "Tier 1", region: "Global"
            },
            "fsf": {
                glyph: "🥦", monthlyFee: 1100, annualFee: 11220, payoutTier: "Tier 1", region: "Global"
            },
            "banking": {
                glyph: "🏦", monthlyFee: 5000, annualFee: 51000, payoutTier: "Tier 3", region: "Global"
            },
            "creative": {
                glyph: "🖋️", monthlyFee: 800, annualFee: 8160, payoutTier: "Tier 1", region: "Global"
            },
            "logistics": {
                glyph: "📦", monthlyFee: 1500, annualFee: 15300, payoutTier: "Tier 2", region: "Global"
            },
            "education-ip": {
                glyph: "📚", monthlyFee: 1200, annualFee: 12240, payoutTier: "Tier 2", region: "Global"
            },
            // Add more sectors with their summary data as needed for your index table
            "fashion": { glyph: "✂", monthlyFee: 900, annualFee: 9180, payoutTier: "Tier 1", region: "Global" },
            "gaming": { glyph: "🎮", monthlyFee: 1800, annualFee: 18360, payoutTier: "Tier 2", region: "Global" },
            "health": { glyph: "🧠", monthlyFee: 2000, annualFee: 20400, payoutTier: "Tier 2", region: "Global" },
            "housing": { glyph: "🏗️", monthlyFee: 1700, annualFee: 17340, payoutTier: "Tier 2", region: "Global" },
            "justice": { glyph: "⚖", monthlyFee: 1300, annualFee: 13260, payoutTier: "Tier 1", region: "Global" },
            "knowledge": { glyph: "📖", monthlyFee: 1000, annualFee: 10200, payoutTier: "Tier 1", region: "Global" },
            "micromesh": { glyph: "☰", monthlyFee: 1400, annualFee: 14280, payoutTier: "Tier 2", region: "Global" },
            "media": { glyph: "🎬", monthlyFee: 1600, annualFee: 16320, payoutTier: "Tier 2", region: "Global" },
            "nutrition": { glyph: "✿", monthlyFee: 950, annualFee: 9690, payoutTier: "Tier 1", region: "Global" },
            "ai-logic": { glyph: "�", monthlyFee: 2500, annualFee: 25500, payoutTier: "Tier 3", region: "Global" },
            "packaging": { glyph: "📦", monthlyFee: 1150, annualFee: 11730, payoutTier: "Tier 1", region: "Global" },
            "quantum": { glyph: "✴️", monthlyFee: 3000, annualFee: 30600, payoutTier: "Tier 3", region: "Global" },
            "ritual": { glyph: "☯", monthlyFee: 700, annualFee: 7140, payoutTier: "Tier 1", region: "Global" },
            "saas": { glyph: "🔑", monthlyFee: 1900, annualFee: 19380, payoutTier: "Tier 2", region: "Global" },
            "trade": { glyph: "🧺", monthlyFee: 2200, annualFee: 22440, payoutTier: "Tier 3", region: "Global" },
            "utilities": { glyph: "🔋", monthlyFee: 1750, annualFee: 17850, payoutTier: "Tier 2", region: "Global" },
            "voice": { glyph: "🎙️", monthlyFee: 1350, annualFee: 13770, payoutTier: "Tier 1", region: "Global" },
            "webless": { glyph: "📡", monthlyFee: 2100, annualFee: 21420, payoutTier: "Tier 3", region: "Global" },
            "nft": { glyph: "🔁", monthlyFee: 1650, annualFee: 16830, payoutTier: "Tier 2", region: "Global" },
            "education-youth": { glyph: "🎓", monthlyFee: 1250, annualFee: 12750, payoutTier: "Tier 1", region: "Global" },
            "zerowaste": { glyph: "♻️", monthlyFee: 1050, annualFee: 10710, payoutTier: "Tier 1", region: "Global" },
            "professional": { glyph: "🧾", monthlyFee: 2800, annualFee: 28560, payoutTier: "Tier 3", region: "Global" },
            "payroll-mining": { glyph: "🪙", monthlyFee: 2300, annualFee: 23460, payoutTier: "Tier 3", region: "Global" },
            "mining": { glyph: "⛏️", monthlyFee: 2400, annualFee: 24480, payoutTier: "Tier 3", region: "Global" },
            "wildlife": { glyph: "🦁", monthlyFee: 750, annualFee: 7650, payoutTier: "Tier 1", region: "Global" }
        };

        // Unified source of truth for all brand details including subnodes and explicit data
        // This now serves as the 'static' or 'pre-defined' brand data.
        const ALL_BRANDS_DETAILS_BY_SECTOR = {
            "agriculture": [
                { name: 'AgroChain', subNodes: ['YieldNode™', 'SoilScan™', 'PestDetect™', 'CropTrace™'], details: {} },
                { name: 'CropSense', subNodes: ['BioTrack™', 'FoodPrint™', 'FarmFresh™'], details: {} },
                { name: 'FarmFresh', subNodes: ['NutriScore™', 'BioTrack™'], details: {} },
                { name: 'NutriScore', subNodes: ['FoodPrint™', 'FarmFresh™'], details: {} },
                { name: 'AgriCore', subNodes: ['SoilSync™', 'CropTrack™', 'FarmLink™'], details: {} },
                { name: 'SoilHealth', subNodes: ['BioBoost™', 'NutrientFlow™', 'EarthGuard™'], details: {} },
                { name: 'CropCircle', subNodes: ['YieldMap™', 'PlantPulse™'], details: {} },
                { name: 'HarvestHub', subNodes: ['GrainGate','ProducePath','MarketLink','FarmFlow'], details: {} },
                { name: 'TerraNova', subNodes: ['LandRevive','SoilBalance','EcoTill','AgroRenew'], details: {} },
                { name: 'GreenSprout', subNodes: ['SeedStart','PlantBoost','GrowTrack','EcoRoot'], details: {} },
                { name: 'AgroLife', subNodes: ['FarmVital','CropCare','SoilSense','HarvestEase'], details: {} },
                { name: 'BioFarm', subNodes: ['EcoGrow','NaturalYield','SoilPure','PlantHealth'], details: {} },
                { name: 'EcoHarvest', subNodes: ['GreenField','CropCycle','SoilNurture','FarmSustain'], details: {} },
                { name: 'SeedLink', subNodes: ['GerminatePro','PlantConnect','GrowNet','RootLink'], details: {} },
                { name: 'SoilSmart', subNodes: ['NutrientTrack','EarthMonitor','SoilScan','FertilEase'], details: {} },
                { name: 'FarmWise', subNodes: ['AgriPlan','CropManage','FieldGuide','HarvestLogic'], details: {} },
                { name: 'CropGuard', subNodes: ['PestShield','DiseaseControl','PlantProtect','YieldSecure'], details: {} },
                { name: 'HarvestEase', subNodes: ['GrainFlow','ProduceEase','MarketAccess','FarmSimplify'], details: {} },
                { name: 'TerraGrow', subNodes: ['LandEnrich','SoilEnhance','EcoFert','AgroBoost'], details: {} },
                { name: 'GreenField', subNodes: ['SeedSelect','PlantOptimize','GrowManage','EcoCultivate'], details: {} },
                { name: 'AgroTech', subNodes: ['FarmInnovate','CropTech','SoilAdvance','HarvestTech'], details: {} },
                { name: 'BioYield', subNodes: ['EcoProduce','NaturalHarvest','SoilRich','PlantGain'], details: {} },
                { name: 'EcoFarm', subNodes: ['GreenCultivate','CropSustain','SoilCare','FarmEco'], details: {} },
                { name: 'AgriPulse', subNodes: ['SoilMonitor','CropSensor','FieldData','HarvestAlert'], details: {} },
                { name: 'BioCrop', subNodes: ['OrganicSeed','PlantHealth','GrowthTrack','EcoYield'], details: {} },
                { name: 'FarmLink', subNodes: ['AgriConnect','FieldNet','CropShare','HarvestSync'], details: {} },
                { name: 'SoilGuard', subNodes: ['NutrientShield','ErosionControl','pHBalance','RootProtect'], details: {} },
                { name: 'GreenHarvest', subNodes: ['EcoCrop','SustainableYield','BioFertilizer','FarmSustain'], details: {} },
                { name: 'TerraFarm', subNodes: ['LandOptimize','SoilEnhance','CropBoost','AgroManage'], details: {} },
                { name: 'SeedSmart', subNodes: ['GerminationTrack','PlantMap','GrowthPredict','YieldForecast'], details: {} },
                { name: 'CropCare', subNodes: ['PestMonitor','DiseaseAlert','PlantHealthCheck','YieldSecure'], details: {} },
                { name: 'HarvestPro', subNodes: ['GrainQuality','ProduceSorting','MarketAccess','FarmLogistics'], details: {} },
                { name: 'SoilSense', subNodes: ['MoistureDetect','NutrientMap','SoilProfile','FertilityIndex'], details: {} },
                { name: 'FarmVision', subNodes: ['SatelliteImagery','CropAnalysis','FieldMapping','YieldEstimation'], details: {} },
                { name: 'AgroTech', subNodes: ['PrecisionFarming','SmartIrrigation','DroneSurvey','DataAnalytics'], details: {} },
                { name: 'BioSoil', subNodes: ['MicrobeEnhance','OrganicMatter','SoilRegen','EcoBalance'], details: {} },
                { name: 'CropTrack', subNodes: ['PlantGrowthMonitor','FieldProgress','HarvestTimeline','YieldReport'], details: {} },
                { name: 'HarvestLink', subNodes: ['SupplyChainConnect','ProduceTrace','MarketIntegration','FarmNetwork'], details: {} },
                { name: 'SoilLab', subNodes: ['pHTesting','NutrientAnalysis','SoilSampling','FertilityReport'], details: {} },
                { name: 'FarmManage', subNodes: ['TaskScheduler','ResourceAllocation','LaborTracking','EquipmentMonitor'], details: {} },
                { name: 'AgriData', subNodes: ['CropRecords','FieldHistory','YieldAnalytics','FarmReports'], details: {} },
                { name: 'BioGrow', subNodes: ['OrganicInputs','PlantNutrition','GrowthEnhancer','EcoSolutions'], details: {} },
                { name: 'EcoFarm', subNodes: ['SustainablePractices','RenewableEnergy','WasteManagement','Biodiversity'], details: {} },
                { name: 'CropMesh', subNodes: ['FieldNet','SoilGrid','YieldLink','NodeTrace'], details: {} },
                { name: 'SeedRoot', subNodes: ['GermCode','SeedID','RootLink','GrowthStart'], details: {} },
                { name: 'SoilVault', subNodes: ['VaultSoil','SampleSecure','LabLink','ResultSync'], details: {} },
                { name: 'PlantCast', subNodes: ['GrowthSignal','WeatherFeed','PlantAlert','FieldNotify'], details: {} },
                { name: 'YieldNode', subNodes: ['NodePath','HarvestTrace','ScrollYield','CropGrid'], details: {} },
                { name: 'FarmBeacon', subNodes: ['ZonePing','CropAlert','SignalYield','TraceLight'], details: {} },
                { name: 'BioSprout', subNodes: ['EcoSeed','VitalTrace','GreenMap','GrowStream'], details: {} },
                { name: 'SoilTrace', subNodes: ['SampleLink','DataStream','FertilMap','FieldTest'], details: {} },
                { name: 'HarvestCore', subNodes: ['HarvestPing','VendorClaim','YieldPoint','CrateDrop'], details: {} },
                { name: 'PlantLink', subNodes: ['PlantID','CrossNode','ZoneSync','QRRoot'], details: {} },
                { name: 'TerraLoop', subNodes: ['AgriCycle','SoilWave','CropSync','EcoChain'], details: {} },
                { name: 'SoilPulse', subNodes: ['PulseCheck','GrowthWave','DepthTrace','FieldFlow'], details: {} },
                { name: 'GreenPatch', subNodes: ['ZoneGrid','OrganicNode','FarmSquare','PlantDrop'], details: {} },
                { name: 'FarmSync', subNodes: ['SyncPoint','CropMerge','LandSplit','VendorMesh'], details: {} },
                { name: 'RootMesh', subNodes: ['NodeSeed','GridSprout','PathFert','MicroPulse'], details: {} },
                { name: 'BioCluster', subNodes: ['CropGroup','FieldChain','VendorLoop','YieldRing'], details: {} },
                { name: 'SproutIndex', subNodes: ['ZoneScan','PlantGrid','GrowthMeter','SeedSync'], details: {} },
                { name: 'MoistureMap', subNodes: ['AquaNode','RootHumidity','DepthScan','FieldAqua'], details: {} },
                { name: 'EcoZone', subNodes: ['GreenClaim','NaturalPath','FarmMesh','ZoneCert'], details: {} },
                { name: 'CropRelay', subNodes: ['YieldSync','VendorCast','CrateSend','RouteField'], details: {} },
                { name: 'FarmCloud', subNodes: ['ScrollFarm','VendorPanel','YieldDash','FieldUpload'], details: {} },
                { name: 'SoilFrame', subNodes: ['FrameID','EarthLine','GridSoil','TestPath'], details: {} },
                { name: 'HarvestPing', subNodes: ['PingGrid','DropYield','ClaimNode','AlertField'], details: {} },
                { name: 'CropCode', subNodes: ['BarcodeRoot','GrowthTag','ScrollField','LabelGrow'], details: {} },
                { name: 'AgroNode', subNodes: ['LandID','CropNode','FieldLink','SoilRoute'], details: {} },
                { name: 'SeedNest', subNodes: ['NestCode','SproutDrop','GrowthLog','FarmBase'], details: {} },
                { name: 'TraceFarm', subNodes: ['FarmScan','VendorLink','HarvestLedger','ScrollProof'], details: {} },
                { name: 'SproutChain', subNodes: ['ChainGrow','YieldLink','NodeDrop','EcoSprout'], details: {} },
                { name: 'SoilStack', subNodes: ['StackClaim','DepthScan','FertilRow','SoilVault'], details: {} },
                { name: 'AgriPanel', subNodes: ['PanelSync','ScrollDash','CropView','VendorControl'], details: {} },
                { name: 'RootClaim', subNodes: ['ClaimTrace','RootID','VendorStamp','FieldLock'], details: {} },
                { name: 'MoistureNode', subNodes: ['HydrateLink','DepthSync','MoistPulse','NodeRain'], details: {} },
                { name: 'CrateFarm', subNodes: ['CrateLedger','DropPanel','MarketNode','VendorCrate'], details: {} },
                { name: 'PlantPing', subNodes: ['AlertRoot','ScanGrow','PlantTrace','PingField'], details: {} },
                { name: 'AgroLoop', subNodes: ['LoopClaim','SoilCycle','FarmMesh','GrowthPath'], details: {} },
                { name: 'CropGrid', subNodes: ['GridYield','MapTrack','HarvestView','CropLink'], details: {} },
                { name: 'VendorSprout', subNodes: ['VendorID','FarmStart','ClaimMap','SproutVault'], details: {} },
                { name: 'BioPing', subNodes: ['MicroScan','HealthAlert','GrowthWatch','RootPath'], details: {} },
                { name: 'EcoFarmGrid', subNodes: ['EcoPlot','FarmJoin','GreenPanel','ZoneMesh'], details: {} },
                { name: 'TerraCode', subNodes: ['SoilDNA','SeedLog','CropCodeX','ScanTag'], details: {} },
                { name: 'HarvestVault', subNodes: ['VaultDrop','CrateClaim','PayoutLock','FieldSecure'], details: {} },
                { name: 'CropBinder', subNodes: ['BinderLoop','VendorTrace','ScrollTag','FarmCode'], details: {} },
                { name: 'SoilCertify', subNodes: ['TestLog','ResultPath','QRProof','SoilPass'] }
            ],
            "fsf": [
                { name: 'FarmFresh', subNodes: ['BioTrack'], details: {} },
                { name: 'NutriScore', subNodes: ['FoodPrint'], details: {} }
            ],
            "banking": [
                {   
                    name: 'FinGrid',   
                    subNodes: ['Ledger Mesh','Arbitrage Core','Token Router','Tax Engine','Vault Lock','Compliance Matrix','Logistics Fin','Currency Glyph','Forecast Engine','Signal Tracker'],
                    details: {
                        intro: "FinGrid™ is the premier FAA.ZONE platform, revolutionizing Banking & Finance operations. Leveraging the global PulseGrid, it offers robust data synchronization and superior efficiency.",
                        keyFeatures: [
                            "Direct Integration with FAA™ Professional Services Mesh.",
                            "Advanced data sync with Ledger Mesh.",
                            "Real-time compliance validation via VaultLink™ (banking specific).",
                            "Scalable architecture for x10 power expansion.",
                            "Predictive analytics module for FinGrid performance.",
                            "API access for seamless interoperability.",
                            "Self-optimizing node distribution for peak efficiency.",
                            "Customizable dashboard and alert systems.",
                            "Cross-sector data interoperability."
                        ],
                        metadata: {
                            productId: "FIN-BAN-5369",
                            vaultId: "VAULT-212U",
                            signalEchoLayer: "Layer Beta v2.5",
                            deploymentZone: "Zone C 4",
                            securityRating: "FAA-SEC B+",
                            activeNodes: "11,810",
                            lastSync: "2025-06-13 18:00 SAST",
                            complianceStatus: "Active & Certified"
                        },
                        realTimeMetrics: {
                            currentPulseActivity: "90,109 pulses/sec",
                            dataVolumeProcessed: "89.66 TB",
                            latencyAverage: "34 ms"
                        },
                        vaultTraceEntries: [
                            "#3514 - FINGA Pulse Tx - Confirmed",
                            "#9619 - BANKI Data Sync - Completed",
                            "#7880 - Node Activation Confirm - Offline",
                            "#128 - VaultTrace Audit - Passed"
                        ]
                    }
                },
                {   
                    name: 'TradeAmp',   
                    subNodes: ['Zeno Mesh','Crux Bridge','Hive Monitor','Wire Reconciler','Bit Locker','Credit Splice','Score Vector','Zentry Core','Drift Trace','Alpha Ledger'],
                    details: {
                        intro: "TradeAmp™ optimizes global trade finance with AI-driven liquidity and secure ledger-based transaction management. Integrated with PulseTrade, it ensures high-speed, compliant, and transparent financial flows.",
                        keyFeatures: [
                            "AI-driven liquidity optimization.",
                            "Immutable transaction ledgering.",
                            "Real-time fraud detection.",
                            "Automated compliance reporting.",
                            "Multi-currency support.",
                            "Smart contract integration for trade agreements."
                        ],
                        metadata: {
                            productId: "TRA-AMP-7001",
                            vaultId: "VAULT-220V",
                            signalEchoLayer: "Layer Gamma v3.0",
                            deploymentZone: "Zone A 1",
                            securityRating: "FAA-SEC A+",
                            activeNodes: "8,500",
                            lastSync: "2025-06-13 17:45 SAST",
                            complianceStatus: "Active & Certified"
                        },
                        realTimeMetrics: {
                            currentPulseActivity: "75,200 pulses/sec",
                            dataVolumeProcessed: "65.12 TB",
                            latencyAverage: "40 ms"
                        },
                        vaultTraceEntries: [
                            "#4122 - TRADEAMP Flow - Confirmed",
                            "#7789 - Payment Sync - Completed",
                            "#9901 - Trade Agreement Hash - Verified",
                            "#203 - Policy Audit - Passed"
                        ]
                    }
                },
                { name: 'LoopPay', subNodes: ['Lumen Pulse','Delta Secure','Fractal Trace','Torus Signal','Mint Bridge','Tally Stream','Bank Depth','Kite Path','Bond Engine','Echo Stack'], details: {} },
                { name: 'TaxNova', subNodes: ['Ark Model','Node Gate','Veritas Sync','Cage Mapper','Core Trace','Sky Sweep','Mint Grid','Orbit Channel','Hash Clear','Micro Chain'], details: {} },
                { name: 'VaultMaster', subNodes: ['Anchor Lock','Fleet Sync','Zoom Channel','Beacon Path','Crate Vault','Numen Index','Spark Flow','Meta Signal','Aether Drift','Custody Map'], details: {} },
                { name: 'Gridwise', subNodes: ['Neutron Signal','Cash Stream','Jet Grid','Pulse Map','Sync Grid','Tangent Vector','Nova Route','Glide Core','Trace Engine','Root Node'], details: {} },
                { name: 'CrateDance', subNodes: ['Bank Shift','Pillar Core','Axon Thread','Monet Route','Layer Core','Verge Node','Stack Tally','Crown Core','Prism Gate','Halo Grid'], details: {} },
                { name: 'CashGlyph', subNodes: ['Clearance Vector','Forge Sync','Bank Mesh','Nano Token','Lattice Path','Noble Curve','Chain Vector','Mint Grid','Bridge Path','Chrono Index'], details: {} },
                { name: 'Foresync', subNodes: ['Unity Sync','Trust Matrix','Vault Score','Lucid Gate','Mint Route','Flight Signal','Teller Index','Custody Trace','Flare Lock','Dark Stream'], details: {} },
                { name: 'OmniRank', subNodes: ['Origin Pulse','Shard Bank','Pay Score','Altimeter Path','Clearing Core','Frame Lock','Zenith Route','Score Helix','Meta Stack','Crux Trace'], details: {} },
                { name: 'ZenoBank', subNodes: ['Pulse Engine','Balance Tally','Gold Trace','Stack Mesh','Quantum Sync','Script Pulse','Vault Stack','Trust Model','Hyper Lock','Tone Gate'], details: {} },
                { name: 'CruxSpend', subNodes: ['Grid Index','Line Mesh','Alpha Signal','Logic Gate','Yield Route','Ratio Core','Ledger Path','Prime Helix','Amp Signal','Lattice Node'], details: {} },
                { name: 'PulseHive', subNodes: ['Credit Curve','Vault Pulse','Data Mesh','Ring Gate','Glyph Stack','Bank Channel','Zen Gate','Loop Vault','Axial Index','Loop Stack'], details: {} },
                { name: 'WireVault', subNodes: ['Pulse Vector','Bank Curve','Helix Gate','Teller Pulse','Tally Signal','Mint Vault'], details: {} }
            ],
            "creative": [
                { name: 'ArtStream', subNodes: ['PixelNode'], details: {} },
                { name: 'DesignHub', subNodes: ['IdeaGrid'], details: {} }
            ],
            "logistics": [
                { name: 'CrateLogic', subNodes: ['BoxNode™', 'CrateMap™', 'PackSync™', 'CrateSync™'], details: {} },
                { name: 'PackChain', subNodes: ['VendorPack™', 'LabelTrace™', 'ShipGrid™', 'ScrollWrap™'], details: {} },
                { name: 'SortFleet', subNodes: ['SortPulse™', 'BinLogic™', 'FleetTrack™', 'ScrollSort™'], details: {} },
                { name: 'RouteMesh', subNodes: ['NodeMap™', 'GeoSignal™', 'DropLink™', 'RouteFlow™'], details: {} },
                { name: 'LogiStack', subNodes: ['ScrollStack™', 'YieldSync™', 'PayoutRoute™', 'StackNode™'], details: {} },
                { name: 'DeliveryX', subNodes: ['LastMile™', 'ScanDrop™', 'AgentTrack™', 'QuickChain™'], details: {} },
                { name: 'CargoVault', subNodes: ['VaultLink™', 'WeightTag™', 'CargoScan™', 'CargoClaim™'], details: {} },
                { name: 'PalletPath', subNodes: ['PathFinder™', 'RackTrace™', 'GridStore™', 'LoadMark™'], details: {} },
                { name: 'LabelFlow', subNodes: ['PrintNode™', 'ScrollCode™', 'InkRoute™', 'LabelSync™'], details: {} },
                { name: 'DropLoop', subNodes: ['LoopID™', 'VendorDrop™', 'TimeGate™', 'LoopConfirm™'], details: {} },
                { name: 'ScrollRoute', subNodes: ['ChainStep™', 'ScanRoute™', 'RouteTrace™', 'FinalMile™'], details: {} },
                { name: 'ShipLedger', subNodes: ['ManifestScroll™', 'LogiProof™', 'ShipCert™', 'DockNode™'], details: {} },
                { name: 'FreightCore', subNodes: ['FreightID™', 'CrateStamp™', 'CargoPulse™', 'StackSync™'], details: {} },
                { name: 'PackSphere', subNodes: ['SphereNode™', 'PackLoop™', 'SupplyCircle™', 'HubRelay™'], details: {} },
                { name: 'GridDrop', subNodes: ['DropTrace™', 'DropID™', 'GridYield™', 'NodeFlow™'], details: {} },
                { name: 'AutoTrack', subNodes: ['GPSClaim™', 'RouteLog™', 'TrackPulse™', 'AutoLink™'], details: {} },
                { name: 'ChainWrap', subNodes: ['WrapNode™', 'TieGlyph™', 'SealMark™', 'ScanProof™'], details: {} },
                { name: 'BinLogicX', subNodes: ['LogicChip™', 'BinSync™', 'ScrollSnap™', 'BinWave™'], details: {} },
                { name: 'PouchNode', subNodes: ['PouchTag™', 'ScrollStick™', 'PackPush™', 'MicroWrap™'], details: {} },
                { name: 'ColdFleet', subNodes: ['ChillRoute™', 'IceLedger™', 'ColdDrop™', 'VaultIce™'], details: {} },
                { name: 'TrackStack', subNodes: ['SignalTag', 'ScrollFleet', 'DockSync', 'TrackMap'], details: {} },
                { name: 'NodeRoute', subNodes: ['HopLink', 'NodeShift', 'MeshGrid', 'RouteCert'], details: {} },
                { name: 'PackOS', subNodes: ['ScrollOS', 'RouteWrap', 'ForkNode', 'PalletLogic'], details: {} },
                { name: 'ZipCrate', subNodes: ['AutoFold', 'SpeedTag', 'CrateDrop', 'ZipSeal'], details: {} },
                { name: 'TagLogic', subNodes: ['ScrollTag', 'GeoTrack', 'TagFrame', 'AutoCert'], details: {} },
                { name: 'ScrollTruck', subNodes: ['ScrollDriver', 'YieldScan', 'CargoBoard', 'DockLink'], details: {} },
                { name: 'FlowVault', subNodes: ['VaultID', 'ScrollStream', 'BoxYield', 'FlowMap'], details: {} },
                { name: 'SortStack', subNodes: ['BinRank', 'BinPulse', 'FastCrate', 'LogicDrop'], details: {} },
                { name: 'DockGrid', subNodes: ['DockFrame', 'PermitTrack', 'ScrollAccess', 'GateID'], details: {} },
                { name: 'RollFleet', subNodes: ['WheelNode', 'PalletSync', 'LoadProof', 'ScrollAxle'], details: {} },
                { name: 'VendSort', subNodes: ['VendorSort', 'BoxPush', 'AutoTray', 'YieldLoop'], details: {} },
                { name: 'GridCrate', subNodes: ['CrateNode', 'GridWrap', 'VaultStack', 'ScrollRoute'], details: {} },
                { name: 'LogiLift', subNodes: ['LiftID', 'FreightPulse', 'ForkSync', 'LogiTag'], details: {} },
                { name: 'CrateX', subNodes: ['CrateTrack', 'SmartLock', 'LabelLink', 'ScrollMap'], details: {} },
                { name: 'QuickLabel', subNodes: ['ScanCode', 'SmartPrint', 'RouteLabel', 'LabelCast'], details: {} },
                { name: 'DropLedger', subNodes: ['LedgerPath', 'DropFlow', 'VaultDrop', 'QuickClaim'], details: {} },
                { name: 'FleetTrace', subNodes: ['TruckPulse', 'ScrollRide', 'AutoPath', 'CrateEcho'], details: {} },
                { name: 'BoxSync', subNodes: ['ScrollSync', 'BoxFrame', 'ClaimID', 'TagSnap'], details: {} },
                { name: 'ChainGate', subNodes: ['GateLog', 'DockPush', 'YieldGate', 'EntryPulse'], details: {} },
                { name: 'ColdRoute', subNodes: ['FreezePoint', 'ScanChill', 'ColdMesh', 'ChillPath'], details: {} },
                { name: 'PalletCore', subNodes: ['CoreLift', 'PalletID', 'PackForce', 'VaultRack'], details: {} },
                { name: 'FreightLine', subNodes: ['LineTrack', 'StackChain', 'DockGrid', 'RouteNode'], details: {} },
                { name: 'PackSignal', subNodes: ['SignalDrop', 'YieldBeacon', 'PackNode', 'PathSync'], details: {} },
                { name: 'ChainVault', subNodes: ['ClaimLink', 'ScrollCert', 'LockDrop', 'AssetTag'], details: {} },
                { name: 'CrateThread', subNodes: ['CrateLink', 'ThreadMark', 'GridLoop', 'FastTag'], details: {} },
                { name: 'ForkYield', subNodes: ['ForkView', 'YieldNode', 'RouteTrek', 'PalletWave'], details: {} },
                { name: 'DockLogic', subNodes: ['DockTag', 'GridScan', 'ZonePath', 'DockAccess'], details: {} },
                { name: 'LoadCast', subNodes: ['LoadSync', 'CrateWatch', 'NodePing', 'AutoConfirm'], details: {} },
                { name: 'TrayTrack', subNodes: ['TrayID', 'PulseLift', 'VendorCrate', 'SyncScan'], details: {} },
                { name: 'ScrollDrop', subNodes: ['AutoYield', 'ScrollLift', 'DropFlag', 'TagNode'], details: {} },
                { name: 'LoopXpress', subNodes: ['LoopSync', 'VendorPush', 'ScrollLoop', 'DropNext'], details: {} },
                { name: 'PackSyncPro', subNodes: ['ProTrack', 'QuickCrate', 'YieldStamp', 'CoreLoop'], details: {} },
                { name: 'VendorWrap', subNodes: ['WrapID', 'VendorPath', 'SecureDrop', 'LabelGate'], details: {} },
                { name: 'CrateLedger', subNodes: ['CrateLock', 'LedgerPath', 'PackTrace', 'AutoCert'], details: {} },
                { name: 'BoxNodeX', subNodes: ['NodeFlow', 'ClaimLock', 'ScanYield', 'FrameTag'], details: {} },
                { name: 'AutoRoute', subNodes: ['AutoJump', 'PathCalc', 'GridRelay', 'VendorMap'], details: {} },
                { name: 'VaultBin', subNodes: ['BinTag', 'SecureBin', 'VaultSignal', 'TraceStore'], details: {} },
                { name: 'LabelTrack', subNodes: ['TrackMark', 'LabelPath', 'QRDrop', 'LabelFlow'], details: {} },
                { name: 'PathLock', subNodes: ['SecurePath', 'ScrollFence', 'LockGate', 'PathProof'], details: {} },
                { name: 'DispatchLoop', subNodes: ['LoopID', 'DispatchSync', 'TagRelease', 'VendorTrack'], details: {} },
                { name: 'ChainPulse', subNodes: ['PulseLink', 'FlowTrack', 'CrateAlert', 'LockSync'], details: {} },
                { name: 'FastTag', subNodes: ['TagFire', 'IDScan', 'QRClaim', 'RouteAlert'], details: {} },
                { name: 'VendorFleet', subNodes: ['FleetMap', 'ScanRoute', 'YieldClaim', 'ChainAccess'], details: {} },
                { name: 'ParcelSync', subNodes: ['SyncBox', 'DropScan', 'AutoLabel', 'ParcelID'], details: {} },
                { name: 'SmartCrate', subNodes: ['SmartClaim', 'CrateGrid', 'LockTrack', 'RFIDNode'], details: {} },
                { name: 'AutoLabel', subNodes: ['LabelSnap', 'PrintFlow', 'AutoScan', 'ConfirmPrint'], details: {} },
                { name: 'FreightGrid', subNodes: ['GridPath', 'LoadBoard', 'VaultTag', 'ShipClaim'], details: {} },
                { name: 'DockFlow', subNodes: ['DockSignal', 'AccessNode', 'LabelCheck', 'LoadLink'], details: {} },
                { name: 'CrateBox', subNodes: ['BoxSync', 'SmartTag', 'FrameDrop', 'PalletLink'], details: {} },
                { name: 'ColdTrack', subNodes: ['ChillLoop', 'IceNode', 'VaultChill', 'ScrollCold'], details: {} },
                { name: 'SecureMesh', subNodes: ['MeshID', 'PathSecure', 'GateTrace', 'NodeFence'], details: {} },
                { name: 'LoopDispatch', subNodes: ['VendorLoop', 'DropTick', 'AutoYield', 'QRConfirm'], details: {} },
                { name: 'AutoLift', subNodes: ['LiftSync', 'TrayPush', 'ForkLoop', 'WeightGate'], details: {} },
                { name: 'ClaimBoard', subNodes: ['BoardCert', 'VendorPush', 'ScrollAttach', 'ProofLine'], details: {} },
                { name: 'ParcelChain', subNodes: ['ChainTrack', 'QuickDrop', 'VendorClaim', 'FastLock'], details: {} },
                { name: 'LabelMesh', subNodes: ['MeshLink', 'TagGrid', 'LabelView', 'ClaimLink'], details: {} },
                { name: 'BoxSignal', subNodes: ['BoxAlert', 'SignalPulse', 'FrameCheck', 'DropYield'], details: {} },
                { name: 'LoadFrame', subNodes: ['LoadDetect', 'CrateSignal', 'DropCheck', 'ScanLine'], details: {} },
                { name: 'VaultRoute', subNodes: ['RouteClaim', 'SignalSync', 'LockMap', 'PathMark'], details: {} },
                { name: 'DockYield', subNodes: ['DockCrate', 'YieldNode', 'SignalTrack', 'ClaimPulse'], details: {} },
                { name: 'CrateSecure', subNodes: ['SecureTag', 'LockCrate', 'VaultProof', 'ChainLock'], details: {} },
                { name: 'LabelFlowX', subNodes: ['FlowTag', 'LabelSync', 'ScanRoute', 'PrintID'], details: {} },
                { name: 'DockMaster', subNodes: ['MasterDock', 'DockTrack', 'LoadSync', 'AccessNode'], details: {} },
                { name: 'PackNet', subNodes: ['NetCrate', 'PackSync', 'NodeLink', 'ChainFlow'], details: {} },
                { name: 'RouteGuard', subNodes: ['GuardRoute', 'PathSecure', 'SignalLock', 'TrackID'], details: {} },
                { name: 'BinLogicPro', subNodes: ['ProBin', 'LogicSync', 'BinTrack', 'NodeProof'], details: {} },
                { name: 'ColdChainX', subNodes: ['ChillTrack', 'ColdSync', 'FreezeNode', 'IceFlow'], details: {} },
                { name: 'AutoPack', subNodes: ['PackAuto', 'SyncLabel', 'AutoCrate', 'FlowNode'], details: {} },
                { name: 'ShipTrack', subNodes: ['TrackShip', 'ShipSync', 'RouteNode', 'DockFlow'], details: {} },
                { name: 'LoadManager', subNodes: ['ManageLoad', 'LoadTrack', 'SyncCrate', 'NodeLink'], details: {} },
                { name: 'CrateManager', subNodes: ['ManageCrate', 'CrateSync', 'VaultTrack', 'LockNode'] }
            ],
            "education-ip": [
                { name: 'EduNest', subNodes: ['LearnNode', 'ScrollSeed', 'CampusID', 'MentorLink', 'PathClaim'], details: {} },
                { name: 'FormFlex', subNodes: ['SkillWrap', 'GradeSync', 'CourseMap', 'IDTrack', 'PupilMesh'], details: {} },
                { name: 'ScrollBooks', subNodes: ['ChapterFlow', 'StoryTag', 'QuizLink', 'YieldRead', 'TextClaim'], details: {} },
                { name: 'MindLift', subNodes: ['BoostTrack', 'LearnSignal', 'LevelUp', 'FocusPath', 'VaultPace'], details: {} },
                { name: 'GridClass', subNodes: ['ClassNode', 'TeachSync', 'VaultBoard', 'EduAlert', 'NodeAttend'], details: {} },
                { name: 'YouthSignal', subNodes: ['SignalDrop', 'SkillPing', 'PeerMesh', 'RoleAssign', 'TrackEcho'], details: {} },
                { name: 'TalentNest', subNodes: ['TalentVault', 'ClaimCoach', 'RoleTree', 'PayoutPath', 'CertifyNode'], details: {} },
                { name: 'PeerPath', subNodes: ['PeerMap', 'ConnectNode', 'SkillVote', 'PathSync', 'LearnOrbit'], details: {} },
                { name: 'ScrollGrade', subNodes: ['GradeID', 'TestVault', 'YieldCredit', 'ExamSync', 'ResultNode'], details: {} },
                { name: 'LearnMesh', subNodes: ['MeshID', 'ModuleLink', 'ClassSync', 'ProgressTag', 'LoopNode'], details: {} },
                { name: 'EduChain', subNodes: ['CourseLink', 'CreditVault', 'CertDrop', 'LearnKey', 'ScrollLedger'], details: {} },
                { name: 'SkillCast', subNodes: ['CastNode', 'MentorPing', 'PeerEcho', 'PayoutRank', 'TalentDrop'], details: {} },
                { name: 'YouthForge', subNodes: ['ForgePath', 'BuildMesh', 'IdeaClaim', 'LearnFoundry', 'PeerLoop'], details: {} },
                { name: 'QuizNet', subNodes: ['QuizTrigger', 'TestField', 'GradeWave', 'RecallGrid', 'PassSync'], details: {} },
                { name: 'ScrollLabs', subNodes: ['LabNode', 'ProjectClaim', 'IdeaTrace', 'SkillXP', 'ModuleYield'], details: {} },
                { name: 'LearnFlag', subNodes: ['FlagRaise', 'SchoolLink', 'RegionTrack', 'PupilEcho', 'ClaimNode'], details: {} },
                { name: 'ScholarMesh', subNodes: ['MeshTrack', 'GradeRelay', 'ScrollDegree', 'LearnVault', 'StudyPulse'], details: {} },
                { name: 'VaultEdu', subNodes: ['IDVault', 'CertChain', 'TranscriptGrid', 'SecureLearn', 'DegreeDrop'], details: {} },
                { name: 'YouthSphere', subNodes: ['CircleCast', 'ClassLink', 'ScrollTribe', 'GroupEcho', 'PeerRing'], details: {} },
                { name: 'EduGlow', subNodes: ['SignalLight', 'LearnPulse', 'BrainSync', 'FlashGrade', 'EnlightNode'], details: {} },
                { name: 'LearnBloom', subNodes: ['BloomNode', 'GrowthTrack', 'SkillSeed', 'EduSprout', 'PeerSoil'], details: {} },
                { name: 'MentorLoop', subNodes: ['LoopConnect', 'WisdomPath', 'MentorVault', 'ScrollPing', 'TeachBond'], details: {} },
                { name: 'YouthID', subNodes: ['IDSync', 'LearnerNode', 'ProofTag', 'IdentityScroll', 'JoinClass'], details: {} },
                { name: 'ScrollQuiz', subNodes: ['QuizNode', 'AnswerTag', 'TimerMesh', 'ScoreClaim', 'ReviewPulse'], details: {} },
                { name: 'PupilChain', subNodes: ['PupilBlock', 'TaskNode', 'LedgerPath', 'EduEcho', 'LearnLock'], details: {} },
                { name: 'IdeaGrid', subNodes: ['IdeaDrop', 'GridThink', 'SparkVault', 'PeerPush', 'ThoughtClaim'], details: {} },
                { name: 'VaultLearn', subNodes: ['SecureScroll', 'GradeLock', 'ChainTest', 'RecordMesh', 'PayoutGrade'], details: {} },
                { name: 'SkillNest', subNodes: ['NestGrow', 'RoleTree', 'PeerRoot', 'MentorNode', 'CertPulse'], details: {} },
                { name: 'ClassFlow', subNodes: ['FlowSync', 'ClassRoute', 'PeerGroup', 'ScrollRing', 'LessonCast'], details: {} },
                { name: 'CertifyCast', subNodes: ['CastAward', 'NodeBadge', 'VaultProof', 'ScrollCredit', 'ChainEarn'], details: {} },
                { name: 'PathMentor', subNodes: ['MentorMap', 'GrowthLink', 'TrailNode', 'ScrollCoach', 'PeerTrace'], details: {} },
                { name: 'IdeaNest', subNodes: ['NestPath', 'SparkClaim', 'ScrollTree', 'PupilEcho', 'ThoughtPulse'], details: {} },
                { name: 'SchoolVault', subNodes: ['VaultGate', 'IDBoard', 'RosterDrop', 'GridEnroll', 'SecureClass'], details: {} },
                { name: 'LearnSignal', subNodes: ['SignalNode', 'BrainPing', 'LessonTrack', 'EduCast', 'PathAlert'], details: {} },
                { name: 'GridBadge', subNodes: ['BadgeSync', 'PathAward', 'TagNode', 'CreditDrop', 'CertLock'], details: {} },
                { name: 'ScrollCraft', subNodes: ['CraftScroll', 'YieldPath', 'PeerSkill', 'VaultMaker', 'ProjectPulse'], details: {} },
                { name: 'MindBoard', subNodes: ['BoardTag', 'ClassSignal', 'IdeaPost', 'TaskDrop', 'VoteMark'], details: {} },
                { name: 'ClassEcho', subNodes: ['EchoNode', 'SyncMesh', 'StudentCast', 'AlertPing', 'ScrollPlay'], details: {} },
                { name: 'VaultPupil', subNodes: ['PupilID', 'SecureClaim', 'GradeVault', 'TrackNode', 'CertTrigger'], details: {} },
                { name: 'YouthSignal', subNodes: ['PeerAlert', 'LoopClaim', 'ScrollWave', 'VoiceDrop', 'IDMesh'], details: {} },
                { name: 'TeachStack', subNodes: ['StackLink', 'LessonPulse', 'GradeBeam', 'TrackNode', 'PeerPath'], details: {} },
                { name: 'StudyCast', subNodes: ['StudyStream', 'PeerJoin', 'QuizSignal', 'ReviewGrid', 'ClassLink'], details: {} },
                { name: 'RoleGrid', subNodes: ['RoleMap', 'ClaimSync', 'PeerTree', 'IdentityPath', 'TagTrack'], details: {} },
                { name: 'LearnFrame', subNodes: ['FrameNode', 'LessonTrace', 'PupilMesh', 'CastDrop', 'ScoreProof'], details: {} },
                { name: 'PulseAcademy', subNodes: ['AcademyPing', 'PeerLight', 'FocusPath', 'VaultLearn', 'BadgeSync'], details: {} },
                { name: 'GradeSync', subNodes: ['GradeLink', 'ResultEcho', 'TestMesh', 'PassTrack', 'VaultSheet'], details: {} },
                { name: 'TeachCircle', subNodes: ['CircleCast', 'MentorPulse', 'ScrollBeam', 'IdeaClaim', 'PeerRing'], details: {} },
                { name: 'CampusNet', subNodes: ['CampusID', 'GroupPath', 'ScrollZone', 'PeerAlert', 'ConnectMesh'], details: {} },
                { name: 'StudyBoard', subNodes: ['StudyNode', 'NoteTrace', 'ProjectGrid', 'SyncClaim', 'ViewRank'], details: {} },
                { name: 'ScrollPath', subNodes: ['PathLink', 'VaultCredit', 'PeerYield', 'LessonGrid', 'ClassSync'], details: {} },
                { name: 'LearnQuest', subNodes: ['QuestNode', 'MapTrack', 'StudyGoal', 'ProgressPath', 'PeerSignal'], details: {} },
                { name: 'EduNestPro', subNodes: ['NestID', 'PathPulse', 'MentorNode', 'VaultGrade', 'PupilClaim'], details: {} },
                { name: 'LoopStudy', subNodes: ['StudyLoop', 'GridSync', 'QuizWave', 'PeerCast', 'ReviewTrack'], details: {} },
                { name: 'GradeForge', subNodes: ['ForgeNode', 'GradeRing', 'ResultPush', 'CertPath', 'LearnLine'], details: {} },
                { name: 'IdeaLink', subNodes: ['SparkLine', 'LoopLink', 'IdeaDrop', 'MentorPing', 'ClassTrace'], details: {} },
                { name: 'TeachTrack', subNodes: ['ClassFlow', 'InstructorNode', 'FeedbackGrid', 'PeerScore', 'PathEcho'], details: {} },
                { name: 'VaultClass', subNodes: ['SecureNode', 'RosterClaim', 'EnrollTrack', 'PeerMap', 'ClassKey'], details: {} },
                { name: 'BadgeMesh', subNodes: ['BadgeID', 'VaultLink', 'ScrollProof', 'AwardBeam', 'PayoutPing'], details: {} },
                { name: 'EduCast', subNodes: ['CoursePing', 'ClassSignal', 'LectureDrop', 'QuizRelay', 'PeerPush'], details: {} },
                { name: 'YouthGrid', subNodes: ['MeshLearn', 'PeerTrace', 'StudyJoin', 'PupilMark', 'LessonSync'], details: {} },
                { name: 'LearnProof', subNodes: ['ProofID', 'CourseClaim', 'ScrollCert', 'VaultDrop', 'GradeLoop'], details: {} },
                { name: 'PathCoach', subNodes: ['CoachNode', 'RolePath', 'ScrollEcho', 'StudyChain', 'CertPush'], details: {} },
                { name: 'TalentID', subNodes: ['TalentClaim', 'VaultPass', 'SkillMap', 'IDScroll', 'LearnLock'], details: {} },
                { name: 'OmniPupil', subNodes: ['OmniLearn', 'ScrollLoop', 'ViewNode', 'ClassCast', 'IDTrack'], details: {} },
                { name: 'SchoolChain', subNodes: ['LedgerLearn', 'BlockEnroll', 'VaultBoard', 'PeerPath', 'ClassFlow'], details: {} },
                { name: 'GradeVault', subNodes: ['VaultClaim', 'CreditPing', 'ScoreSheet', 'SecureDrop', 'LedgerTrack'] }
            ],
            "admin-panel": [] // Admin panel doesn't have brands/nodes in the same way
        };

        // This holds the structure for products and their features based on pricing tiers
        const SECTOR_TIER_PRICING = {
            "Starter": {
                multiplier: 1,
                features: [
                    "Basic Data Synchronization",
                    "Community Support via Portal",
                    "Limited API Access",
                    "Up to 5 Subnodes",
                    "Standard Analytics Dashboard",
                    "Monthly Compliance Reports"
                ],
                monthlyMetrics: {
                    'Avg. API Calls/day': '1,000',
                    'Data Sync Latency': '50ms',
                    'Support Tickets/month': '5'
                }
            },
            "Pro": {
                multiplier: 2.5,
                features: [
                    "Advanced Data Synchronization",
                    "Priority Email Support",
                    "Full API Access",
                    "Up to 50 Subnodes",
                    "Real-Time Analytics Dashboard",
                    "Weekly Compliance Reports",
                    "Custom Alert System",
                    "Multi-Region Deployment"
                ],
                monthlyMetrics: {
                    'Avg. API Calls/day': '10,000',
                    'Data Sync Latency': '20ms',
                    'Support Tickets/month': '2'
                }
            },
            "Enterprise": {
                multiplier: 5,
                features: [
                    "Enterprise-Grade Data Synchronization",
                    "Dedicated Account Manager",
                    "24/7 Phone & Email Support",
                    "Unlimited Subnodes",
                    "Customizable Analytics & Reporting",
                    "Daily Compliance Reports & Audits",
                    "AI-Powered Anomaly Detection",
                    "Global Deployment Zones",
                    "On-Site Training & Setup"
                ],
                monthlyMetrics: {
                    'Avg. API Calls/day': '100,000+',
                    'Data Sync Latency': '5ms',
                    'Support Tickets/month': '0.5' // Indicating rare or very quick resolution
                }
            }
        };

        // Initialize client-side data from localStorage or as an empty object
        let clientAdminData = JSON.parse(localStorage.getItem("clientAdminData")) || {};

        // --- FIX for Issue #3: Robust initialization and data structure for clientAdminData ---
        // Ensure clientAdminData has all sectors initialized with empty brands arrays (of objects)
        for (const sectorKey in sectorList) {
            if (!clientAdminData[sectorKey]) {
                clientAdminData[sectorKey] = { brands: [] }; // Initialize brands as an empty array of objects
            } else if (!Array.isArray(clientAdminData[sectorKey].brands)) {
                // If 'brands' property exists but is not an array, re-initialize it.
                // This handles cases where old localStorage data might have different formats.
                console.warn(`clientAdminData for sector ${sectorKey} has a non-array 'brands' property. Re-initializing.`);
                clientAdminData[sectorKey].brands = [];
            } else {
                // Ensure existing brands in clientAdminData are objects with a 'subNodes' array
                clientAdminData[sectorKey].brands = clientAdminData[sectorKey].brands.map(brand => {
                    if (typeof brand === 'string') {
                        // Convert old string format to object format
                        return { name: brand, subNodes: [`${brand.slice(0,3).toUpperCase()}Node`] };
                    }
                    // Ensure subNodes exists and is an array
                    if (!brand.subNodes || !Array.isArray(brand.subNodes)) {
                        brand.subNodes = [];
                    }
                    return brand;
                });
            }
        }


        // Dummy static data for ALL_SECTOR_DATA_STATIC (if your backend isn't running)
        // This is a copy of ALL_BRANDS_DETAILS_BY_SECTOR but structured as { brands: [], subNodes: [[]] } for calculation
        // In a real app, this would come from your backend.
        const ALL_SECTOR_DATA_STATIC = {};
        for (const sectorKey in ALL_BRANDS_DETAILS_BY_SECTOR) {
            ALL_SECTOR_DATA_STATIC[sectorKey] = {
                brands: ALL_BRANDS_DETAILS_BY_SECTOR[sectorKey].map(b => b.name),
                // Correctly map subnodes for static data
                subNodes: ALL_BRANDS_DETAILS_BY_SECTOR[sectorKey].map(b => b.subNodes)
            };
        }


        // Wrap the entire main script logic in an IIFE
        (function() {

            // --- Core Admin Panel Functions ---
            // These functions manage section visibility and main navigation
            let currentActivePanelId = null;
            let activeBrandButton = null; // To keep track of the currently active brand button

            // Function to load the main dashboard content from the backend
            // NOTE: This function assumes a backend is running at http://localhost:3000/api/sectors
            // If you don't have a backend, this part will show an error.
            async function loadMainDashboardData() {
                const dashboard = document.getElementById("brandDashboard"); // This element doesn't exist in the admin HTML
                // This function seems to be intended for a different page (e.g., index.html or products.html)
                // For the admin panel, we are using renderFaaZoneIndexTable and displaySectorSpecificProducts
                console.warn("loadMainDashboardData called in Admin Portal. This function is likely for another page (e.g., index.html). Skipping execution in admin panel context.");
                // Removed the fetch call here as it's not directly used for the admin panel's current structure
                // You can re-enable and adapt if you have a specific dashboard area in this admin portal.
            }

            window.showAdminSection = function(sectionId, clickedLink) {
                // Hide all sections and deactivate all nav links first
                document.querySelectorAll('section[id$="-section"]').forEach(el => el.classList.add('hidden'));
                document.querySelectorAll('.admin-nav-scroll a').forEach(link => link.classList.remove('active'));

                const section = document.getElementById(sectionId);
                if (section) {
                    section.classList.remove('hidden');
                    if (clickedLink) {
                        clickedLink.classList.add('active');
                        currentActivePanelId = sectionId;
                    }
                    // Clear previous brand snapshot when switching main sections
                    document.getElementById('brandDetailsContainer').innerHTML = '';
                    if (activeBrandButton) {
                        activeBrandButton.classList.remove('active');
                        activeBrandButton = null;
                    }

                    // Specific actions based on the section being shown
                    if (sectionId === 'metrics-section') {
                        if (!pulseChartInstance) {
                            renderDynamicPulseChart();
                        }
                        // Ensure interval is running only when metrics section is active
                        if (!window._pulseChartInterval) {
                            window._pulseChartInterval = setInterval(updateDynamicPulseChart, 3000);
                        }
                        calculateGlobalMetrics(); // Update metrics when entering this section
                    } else {
                        // Clear interval when leaving metrics section
                        if (window._pulseChartInterval) {
                            clearInterval(window._pulseChartInterval);
                            window._pulseChartInterval = null;
                        }
                    }

                    if (sectionId === 'global-index-section') {
                        renderFaaZoneIndexTable();
                        calculateGlobalMetrics();
                    } else if (sectionId === 'add-brand-section') {
                        populateSectorSelect();
                        calculateGlobalMetrics();
                        renderFaaZoneIndexTable(); // Ensure table is rendered if this is the first section shown
                    }
                    else if (sectionId === 'sector-view-section') {
                        populateSectorViewSelect();
                        const sectorViewSelect = document.getElementById('sectorViewSelect');
                        // Display the first available sector by default if none selected or if it's the first time
                        // Ensure we don't pick 'admin-panel' as a default viewable sector
                        const viewableSectors = Object.keys(sectorList).filter(key => key !== 'admin-panel');
                        if (sectorViewSelect.value === '' && viewableSectors.length > 0) {
                            sectorViewSelect.value = viewableSectors[0];
                            displaySectorSpecificProducts(sectorViewSelect.value);
                        } else if (sectorViewSelect.value !== '') {
                            // Re-display if a sector was already selected
                            displaySectorSpecificProducts(sectorViewSelect.value);
                        }
                    }
                }
            }
            
            function populateSectorSelect() {
                const select = document.getElementById('sectorSelect');
                if (!select) return;
                select.innerHTML = ''; // Clear existing options
                Object.entries(sectorList).forEach(([key, label]) => {
                    if (key !== 'admin-panel') { // Exclude admin panel from being a target sector
                        const option = document.createElement('option');
                        option.value = key;
                        option.textContent = label;
                        select.appendChild(option);
                    }
                });
            }
            
            function populateSectorViewSelect() {
                const select = document.getElementById('sectorViewSelect');
                if (!select) return;
                select.innerHTML = '';

                const defaultOption = document.createElement('option');
                defaultOption.value = '';
                defaultOption.textContent = '--- Select a Sector ---';
                select.appendChild(defaultOption);

                Object.entries(sectorList).forEach(([key, label]) => {
                    if (key !== 'admin-panel') {
                        const option = document.createElement('option');
                        option.value = key;
                        option.textContent = label;
                        select.appendChild(option);
                    }
                });

                select.removeEventListener('change', handleSectorViewChange); 
                select.addEventListener('change', handleSectorViewChange);
            }

            function handleSectorViewChange(event) {
                const selectedSectorKey = event.target.value;
                if (activeBrandButton) {
                    activeBrandButton.classList.remove('active');
                    activeBrandButton = null;
                }
                document.getElementById('brandDetailsContainer').innerHTML = '';

                if (selectedSectorKey) {
                    displaySectorSpecificProducts(selectedSectorKey);
                } else {
                    document.getElementById('dynamicSectorDashboard').innerHTML = '<p class="text-gray-400 col-span-full text-center mt-8">Select a sector to view its detailed dashboard.</p>';
                }
            }

            function addBrandToSector() {
                const sectorSelect = document.getElementById("sectorSelect");
                const brandInput = document.getElementById("brandInput");
                const subnodesInput = document.getElementById("subnodesInput");
                const adminStatus = document.getElementById("adminStatus");
                const addBrandBtn = document.getElementById("addBrandBtn");

                const sectorKey = sectorSelect.value;
                const brandName = brandInput.value.trim();
                const subnodesArray = subnodesInput.value.split(",").map(n => n.trim()).filter(Boolean);

                if (!brandName || subnodesArray.length === 0) {
                    adminStatus.textContent = "⚠️ Please fill in both brand name and at least one subnode.";
                    adminStatus.classList.remove('text-green-500');
                    adminStatus.classList.add('text-red-500');
                    addBrandBtn.classList.remove('bg-indigo-600', 'hover:bg-indigo-700');
                    addBrandBtn.classList.add('bg-red-500', 'hover:bg-red-600');
                    setTimeout(() => {
                        adminStatus.textContent = "Ready to receive input.";
                        adminStatus.classList.remove('text-red-500');
                        addBrandBtn.classList.remove('bg-red-500', 'hover:bg-red-600');
                        addBrandBtn.classList.add('bg-indigo-600', 'hover:bg-indigo-700');
                    }, 3000);
                    return;
                }

                // Simulate saving to backend and updating local data
                console.log(`Attempting to add brand "${brandName}" with subnodes [${subnodesArray.join(', ')}] to sector "${sectorKey}"`);
                
                // In a real application, you would send this data to your backend via fetch:
                // fetch('http://localhost:3000/api/sectors', { ... }).then(...)
                // For this example, we'll just update clientAdminData directly.

                if (!clientAdminData[sectorKey]) {
                    clientAdminData[sectorKey] = { brands: [] };
                }
                // Add the brand as an object to match the structure expected by generateMockBrandSnapshotData
                // Ensure clientAdminData.brands stores objects with name and subNodes
                clientAdminData[sectorKey].brands.push({ name: brandName, subNodes: subnodesArray });

                localStorage.setItem("clientAdminData", JSON.stringify(clientAdminData));

                adminStatus.textContent = `✅ Added ${brandName} to ${sectorList[sectorKey]} (Client-Side).`;
                adminStatus.classList.remove('text-red-500');
                adminStatus.classList.add('text-green-500');
                addBrandBtn.classList.remove('bg-indigo-600', 'hover:bg-indigo-700');
                addBrandBtn.classList.add('bg-green-500', 'hover:bg-green-600');
                addBrandBtn.innerHTML = '✔️ Added!';
                
                renderFaaZoneIndexTable(); // Re-render FAA Zone Index table
                calculateGlobalMetrics(); // Recalculate metrics
                if (currentActivePanelId === 'sector-view-section' && document.getElementById('sectorViewSelect').value === sectorKey) {
                    displaySectorSpecificProducts(sectorKey); // Re-render sector view if it's the active sector
                }

                brandInput.value = "";
                subnodesInput.value = "";

                setTimeout(() => {
                    adminStatus.textContent = "Ready to receive input.";
                    adminStatus.classList.remove('text-green-500', 'text-red-500');
                    addBrandBtn.classList.remove('bg-green-500', 'hover:bg-green-600');
                    addBrandBtn.classList.add('bg-indigo-600', 'hover:bg-indigo-700');
                    addBrandBtn.innerHTML = '➕ Add Brand';
                }, 3000);
            }
            
            function clearAdminAddedData() {
                localStorage.removeItem("clientAdminData");
                clientAdminData = {};
                // Re-initialize clientAdminData for all sectors as empty objects with empty brands arrays
                for (const sectorKey in sectorList) {
                    clientAdminData[sectorKey] = { brands: [] };
                }
                renderFaaZoneIndexTable();
                calculateGlobalMetrics();
                document.getElementById('dynamicSectorDashboard').innerHTML = '<p class="text-gray-400 col-span-full text-center mt-8">Select a sector to view its detailed dashboard.</p>';
                document.getElementById('brandDetailsContainer').innerHTML = '';
                // No need to loadMainDashboardData here if it's only for a different page.

                const adminStatus = document.getElementById("adminStatus");
                adminStatus.textContent = "🗑️ Client-side admin data cleared.";
                adminStatus.classList.remove('text-red-500');
                adminStatus.classList.add('text-green-500');
                setTimeout(() => { 
                    adminStatus.textContent = "Ready to receive input.";
                    adminStatus.classList.remove('text-green-500');
                }, 3000);
            }
            
            // Function to toggle between monthly and annual prices
            window.toggleSubscriptionType = function(cardElement, isAnnualChecked) {
                const priceSpan = cardElement.querySelector('.price-display');
                const originalMonthlyPrice = parseFloat(priceSpan.dataset.originalMonthlyPrice);
                const originalAnnualPrice = parseFloat(priceSpan.dataset.originalAnnualPrice);
                const currentCurrency = priceSpan.dataset.currencyCode || BASE_CURRENCY;

                let newPrice;
                let newBillingCycle;
                let suffix;

                if (isAnnualChecked) {
                    newPrice = originalAnnualPrice;
                    newBillingCycle = "ANNUAL";
                    suffix = "/ year";
                } else {
                    newPrice = originalMonthlyPrice;
                    newBillingCycle = "MONTHLY";
                    suffix = "/ month";
                }

                let convertedPrice = newPrice;
                if (currentCurrency !== BASE_CURRENCY && exchangeRates[currentCurrency]) {
                    convertedPrice = newPrice * exchangeRates[currentCurrency];
                }
                
                priceSpan.innerHTML = `${window.getCurrencySymbol(currentCurrency)}${convertedPrice.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})} <span class="text-xl text-gray-400">${suffix}</span>`;

                const buyButton = cardElement.querySelector('.buy-now-button');
                const paypalContainer = cardElement.querySelector('.paypal-button-container');
                if (paypalContainer) {
                    paypalContainer.dataset.amount = newPrice.toFixed(2);
                    paypalContainer.dataset.billingCycle = newBillingCycle;
                    const itemName = buyButton.dataset.itemName;
                    const basePlanName = itemName.replace(/\s/g, '_').toLowerCase();
                    const specificPlanKey = `${basePlanName}_${newBillingCycle.toLowerCase()}`;
                    paypalContainer.dataset.planKey = specificPlanKey; // Pass the specific logical plan key

                    // IMPORTANT: Re-rendering PayPal buttons on currency/toggle change is complex.
                    // The PayPal SDK expects to be rendered once. Dynamically changing plan_id on a rendered button
                    // is not directly supported. For this mock, simply updating dataset is illustrative.
                    // In a real app, you might need to destroy and re-create the PayPal button,
                    // or handle the price change in a way that doesn't rely on button re-render.
                    // For now, if the PayPal button is already rendered, we don't touch it.
                    // A user would have to click the "Subscribe Now" button again to pick up the new price.
                    // Or, simpler for this demo, we re-trigger the rendering of products when currency changes
                    // which rebuilds the PayPal buttons.
                }

            }

            // --- Mock Data Generation for Brand Snapshots ---
            function generateMockBrandSnapshotData(sectorKey, brandName, explicitSubnodes = []) {
                let subnodes = explicitSubnodes;
                if (subnodes.length === 0) {
                    const staticSectorBrands = ALL_BRANDS_DETAILS_BY_SECTOR[sectorKey] || [];
                    const staticBrandEntry = staticSectorBrands.find(b => b.name === brandName);
                    if (staticBrandEntry && staticBrandEntry.subNodes && staticBrandEntry.subNodes.length > 0) {
                        subnodes = staticBrandEntry.subNodes;
                    } else {
                        // Fallback if no static or explicitly provided subnodes
                        subnodes = [`MockNode ${brandName.slice(0,3).toUpperCase()}A™`, `MockNode ${brandName.slice(0,3).toUpperCase()}B™`];
                    }
                }
                
                const sectorInfo = FAA_ZONE_INDEX_SUMMARY_DATA[sectorKey] || {};
                const sectorDisplayName = sectorList[sectorKey] || sectorKey.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase());

                const baseId = brandName.replace(/[^a-zA-Z0-9]/g, '').toUpperCase().substring(0, 5);
                const randomNum = () => Math.floor(Math.random() * 9000) + 1000;
                const randomPulse = () => (Math.random() * 50 + 50).toFixed(2);
                const randomDataVolume = () => (Math.random() * 100 + 10).toFixed(2);
                const randomLatency = () => (Math.random() * 50 + 10).toFixed(2);
                const randomActiveNodes = () => Math.floor(Math.random() * 1000) + 50;
                const randomAuditDate = () => `2025-${(Math.floor(Math.random() * 12) + 1).toString().padStart(2, '0')}-${(Math.floor(Math.random() * 28) + 1).toString().padStart(2, '0')}`;
                
                const introVariations = [
                    `a cutting-edge FAA.ZONE solution designed for the ${sectorDisplayName} sector. It seamlessly integrates with the global PulseGrid to deliver unparalleled performance and data integrity.`,
                    `the premier FAA.ZONE platform, revolutionizing ${sectorDisplayName} operations. Leveraging the global PulseGrid, it offers robust data synchronization and superior efficiency.`,
                    `an innovative FAA.ZONE protocol, specifically engineered for the demands of the ${sectorDisplayName} industry. Its deep integration with the PulseGrid ensures secure, real-time data flows and enhanced decision-making.`,
                    `a powerful FAA.ZONE framework empowering the ${sectorDisplayName} sector with advanced automation and data management. It connects effortlessly to the PulseGrid for optimized workflow and compliance.`
                ];
                const randomIntro = introVariations[Math.floor(Math.random() * introVariations.length)];

                const coreFeatures = [
                    `Direct integration with FAA 🧾 Professional Services Mesh.`,
                    `Advanced data sync with ${Array.isArray(subnodes) && subnodes.length > 0 ? subnodes[0] : 'core nodes'}.`,
                    `Real-time compliance validation via VaultLink™ (${sectorKey} specific).`,
                    `Scalable architecture for x${Math.ceil(Math.random() * 50) + 10} power expansion.`,
                    `Predictive analytics module for ${brandName} performance.`,
                    `API access for seamless interoperability.`
                ];

                const additionalFeaturesPool = [
                    `Cross-sector data interoperability.`, `AI-driven anomaly detection and fraud prevention.`, `Self-optimizing node distribution for peak efficiency.`, `One-click regulatory reporting and audit trails.`, `Customizable dashboard and alert systems.`, `Secure multi-party computation support.`, `Dynamic resource allocation for fluctuating demands.`, `Blockchain-secured data provenance.`
                ];

                const selectedAdditionalFeatures = [];
                const tempAdditionalFeatures = [...additionalFeaturesPool];
                for (let i = 0; i < Math.floor(Math.random() * 3) + 3; i++) {
                    if (tempAdditionalFeatures.length > 0) {
                        const randomIndex = Math.floor(Math.random() * tempAdditionalFeatures.length);
                        selectedAdditionalFeatures.push(tempAdditionalFeatures.splice(randomIndex, 1)[0]);
                    }
                }
                
                const allFeatures = [...coreFeatures, ...selectedAdditionalFeatures];

                const baseMonthlyFee = parseFloat(String(sectorInfo.monthlyFee).replace('$', '').replace(',', ''));
                const annualDiscountRate = 0.15;

                const pricingTiers = [
                    {   
                        name: "Starter Node",   
                        monthlyAmount: baseMonthlyFee * SECTOR_TIER_PRICING.Starter.multiplier,   
                        annualAmount: baseMonthlyFee * SECTOR_TIER_PRICING.Starter.multiplier * 12 * (1 - annualDiscountRate),
                        description: "Ideal for small teams and pilot projects. Access essential features and secure basic data synchronization.",   
                        benefits: ["Essential features", "Basic data sync", "Community support"]   
                    },
                    {   
                        name: "Pro Grid",   
                        monthlyAmount: baseMonthlyFee * SECTOR_TIER_PRICING.Pro.multiplier,   
                        annualAmount: baseMonthlyFee * SECTOR_TIER_PRICING.Pro.multiplier * 12 * (1 - annualDiscountRate),
                        description: `Designed for growing firms needing advanced capabilities. Includes ${Math.ceil(Math.random() * 5 + 3)} core features and enhanced performance.`,   
                        benefits: ["Advanced features", "High-volume data processing", "Priority support", "Expanded analytics"]   
                    },
                    {   
                        name: "Enterprise Omni-Sync",   
                        monthlyAmount: baseMonthlyFee * SECTOR_TIER_PRICING.Enterprise.multiplier,   
                        annualAmount: baseMonthlyFee * SECTOR_TIER_PRICING.Enterprise.multiplier * 12 * (1 - annualDiscountRate),
                        description: "For large organizations requiring full VaultMesh access, custom integrations, and dedicated resources.",   
                        benefits: ["Full VaultMesh access", "Dedicated account manager", "24/7 Phone Support", "Enhanced Custom Integrations", "On-site Training & Setup"]   
                    }
                ];

                const mockData = {
                    sectorGlyph: sectorInfo.glyph || '�',
                    sectorName: sectorDisplayName,
                    brandName: brandName,
                    intro: randomIntro,
                    keyFeatures: allFeatures,
                    subnodes: subnodes,
                    pricing: pricingTiers,
                    metadata: {
                        productId: `${baseId}-${randomNum()}`,
                        vaultId: `VAULT-${randomNum()}`,
                        signalEchoLayer: `Layer ${Math.random() < 0.5 ? 'Alpha' : 'Beta'} v${(Math.random() * 5).toFixed(1)}`,
                        deploymentZone: `Zone ${String.fromCharCode(65 + Math.floor(Math.random() * 5))} ${Math.floor(Math.random() * 10) + 1}`,
                        securityRating: `FAA-SEC ${['A+', 'A', 'B+', 'B', 'C'].at(Math.floor(Math.random() * 5))}`,
                        activeNodes: randomActiveNodes(),
                        lastSync: randomAuditDate(),
                        complianceStatus: Math.random() > 0.2 ? 'Active & Certified' : 'Pending Review'
                    },
                    realTimeMetrics: {
                        currentPulseActivity: `${randomPulse()} pulses/sec`,
                        dataVolumeProcessed: `${randomDataVolume()} TB`,
                        latencyAverage: `${randomLatency()} ms`
                    },
                    vaultTraceEntries: [
                        `#${randomNum()} - ${baseId} Pulse Tx - Confirmed`,
                        `#${randomNum()} - ${sectorKey.slice(0,5).toUpperCase().replace(/[^A-Z0-9]/g, '')} Data Sync - Completed`,
                        `#${randomNum()} - Node Activation Confirm - ${Math.random() > 0.5 ? 'Online' : 'Offline'}`,
                        `#${randomNum()} - VaultTrace Audit - Passed`
                    ]
                };

                return mockData;
            }

            // --- Display Brand Details (Snapshot) ---
            window.displayBrandDetails = function(sectorKey, brandName, clickedButton) { // Made global
                const container = document.getElementById('brandDetailsContainer');
                if (!container) {
                    console.error("Brand details container not found!");
                    return;
                }

                document.querySelectorAll('#sectorBrandButtons .brand-button').forEach(btn => {
                    btn.classList.remove('active');
                });

                if (clickedButton) {
                    clickedButton.classList.add('active');
                    activeBrandButton = clickedButton;
                }

                let selectedBrand = null;
                const staticBrandsInSector = ALL_BRANDS_DETAILS_BY_SECTOR[sectorKey] || [];
                selectedBrand = staticBrandsInSector.find(b => b.name === brandName);

                // Check client-added data if not found in static
                if (!selectedBrand) {
                    const clientAddedBrandsInSector = clientAdminData[sectorKey]?.brands || [];
                    selectedBrand = clientAddedBrandsInSector.find(b => b.name === brandName);
                }

                const currentSubNodesForSnapshot = selectedBrand && selectedBrand.subNodes ? selectedBrand.subNodes : [];

                let brandSnapshotData = generateMockBrandSnapshotData(sectorKey, brandName, currentSubNodesForSnapshot);
                if (selectedBrand && selectedBrand.details && Object.keys(selectedBrand.details).length > 0) {
                    // Merging details from static data if available
                    brandSnapshotData = { 
                        ...brandSnapshotData, 
                        ...selectedBrand.details,
                        metadata: { ...brandSnapshotData.metadata, ...(selectedBrand.details.metadata || {}) },
                        realTimeMetrics: { ...brandSnapshotData.realTimeMetrics, ...(selectedBrand.details.realTimeMetrics || {}) }, // Corrected typo here
                        pricing: selectedBrand.details.pricing || brandSnapshotData.pricing,
                        vaultTraceEntries: selectedBrand.details.vaultTraceEntries || brandSnapshotData.vaultTraceEntries
                    };
                }

                const currentCurrency = document.getElementById('sector-currency-select').value;
                const currencySymbol = getCurrencySymbol(currentCurrency);

                let snapshotHtml = `
                    <div class="admin-panel-card mt-6">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-2xl font-bold">${brandSnapshotData.sectorGlyph} FAA™ ${brandSnapshotData.sectorName.replace(/<.*?>/g, '')} Dashboard</h3>
                            <button onclick="window.closeBrandDetails()" class="text-red-500 hover:text-red-700 font-semibold transition-colors">
                                ❌ Close
                            </button>
                        </div>

                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                            <div class="lg:col-span-2 admin-panel-card !p-6">
                                <h4 class="text-xl font-bold mb-4">${brandSnapshotData.brandName} Core Protocol Overview</h4>
                                <p class="text-gray-400 mb-4">
                                    ${brandSnapshotData.brandName}™ is ${brandSnapshotData.intro}
                                </p>
                                
                                <h5 class="text-lg font-semibold mb-2 mt-4">🎛️ Key Features</h5>
                                <ul class="list-disc list-inside text-gray-300 ml-4 mb-6">
                                    ${brandSnapshotData.keyFeatures.map(f => `<li>${f}</li>`).join('')}
                                </ul>

                                <h5 class="text-lg font-semibold mb-2 mt-4">📌 Subnodes</h5>
                                <ul class="list-disc list-inside text-gray-300 ml-4 mb-6">
                                    ${brandSnapshotData.subnodes.map(n => `<li>${n}</li>`).join('')}
                                </ul>

                                <h5 class="text-lg font-semibold mb-2 mt-4">💳 Pricing Structure (Derived from Sector Tier Pricing)</h5>
                                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 text-sm">
                                    ${brandSnapshotData.pricing.map(tier => {
                                        let displayMonthlyPrice = tier.monthlyAmount;
                                        let displayAnnualPrice = tier.annualAmount;
                                        let priceSuffix = "/ month";
                                        let displayPrice = displayMonthlyPrice;

                                        if (currentCurrency !== BASE_CURRENCY && exchangeRates[currentCurrency]) {
                                            displayMonthlyPrice = displayMonthlyPrice * exchangeRates[currentCurrency];
                                            displayAnnualPrice = displayAnnualPrice * exchangeRates[currentCurrency];
                                            displayPrice = displayMonthlyPrice;
                                        }

                                        const firstProductCard = document.querySelector('#dynamicSectorDashboard .product-card');
                                        let isAnnualChecked = false;
                                        if (firstProductCard) {
                                            const toggleCheckbox = firstProductCard.querySelector('.toggle-switch input[type="checkbox"]');
                                            if (toggleCheckbox) {
                                                isAnnualChecked = toggleCheckbox.checked;
                                            }
                                        }

                                        if (isAnnualChecked) {
                                            displayPrice = displayAnnualPrice;
                                            priceSuffix = "/ year";
                                        }

                                        return `
                                            <div class="bg-gray-800 p-4 rounded-md border border-gray-700">
                                                <h6 class="font-semibold text-blue-300">${tier.name}</h6>
                                                <p class="text-xl font-bold text-blue-400 mt-1">
                                                    ${currencySymbol}${displayPrice.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})} <span class="text-sm text-gray-400">${priceSuffix}</span>
                                                </p>
                                                <p class="text-gray-400 mt-2 text-xs">${tier.description}</p>
                                                <ul class="text-xs text-gray-500 list-disc list-inside ml-3 mt-2">
                                                    ${tier.benefits.map(b => `<li>${b}</li>`).join('')}
                                                </ul>
                                            </div>
                                        `;
                                    }).join('')}
                                </div>
                            </div>

                            <div class="lg:col-span-1 admin-panel-card !p-6 space-y-4">
                                <h4 class="text-xl font-bold mb-4">🔗 FAA Data & Compliance</h4>
                                <ul class="list-none p-0 m-0 space-y-2 text-gray-300">
                                    <li><span class="font-semibold text-blue-300">Product ID:</span> <code>${brandSnapshotData.metadata.productId}</code></li>
                                    <li><span class="font-semibold text-blue-300">VaultID:</span> <code>${brandSnapshotData.metadata.vaultId}</code></li>
                                    <li><span class="font-semibold text-blue-300">Signal Echo Layer:</span> <code>${brandSnapshotData.metadata.signalEchoLayer}</code></li>
                                    <li><span class="font-semibold text-blue-300">Deployment Zone:</span> <code>${brandSnapshotData.metadata.deploymentZone}</code></li>
                                    <li><span class="font-semibold text-blue-300">Security Rating:</span> <span class="font-bold text-green-500">${brandSnapshotData.metadata.securityRating}</span></li>
                                    <li><span class="font-semibold text-blue-300">Active Nodes:</span> <code>${brandSnapshotData.metadata.activeNodes.toLocaleString()}</code></li>
                                    <li><span class="font-semibold text-blue-300">Last Audit:</span> <code>${brandSnapshotData.metadata.lastSync}</code></li>
                                    <li><span class="font-semibold text-blue-300">Compliance Status:</span> <span class="font-bold text-green-500">${brandSnapshotData.metadata.complianceStatus}</span></li>
                                </ul>

                                <h5 class="text-lg font-semibold mb-2 mt-4">📊 Real-Time Metrics</h5>
                                <ul class="list-none p-0 m-0 space-y-2 text-gray-300">
                                    <li><span class="font-semibold text-blue-300">Current Pulse Activity:</span> ${brandSnapshotData.realTimeMetrics.currentPulseActivity}</li>
                                    <li><span class="font-semibold text-blue-300">Data Volume Processed (24h):</span> ${brandSnapshotData.realTimeMetrics.dataVolumeProcessed}</li>
                                    <li><span class="font-semibold text-blue-300">Latency Average:</span> ${brandSnapshotData.realTimeMetrics.latencyAverage}</li>
                                </ul>

                                <h5 class="text-lg font-semibold mb-2 mt-4">🧾 VaultTrace™ Ledger Entries</h5>
                                <ul class="list-disc list-inside text-gray-300 ml-4 space-y-1">
                                    ${brandSnapshotData.vaultTraceEntries.map(entry => `<li><code>${entry}</code></li>`).join('')}
                                </ul>
                            </div>
                        </div>
                    </div>
                `;
                container.innerHTML = snapshotHtml;
                container.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }

            window.closeBrandDetails = function() {
                document.getElementById('brandDetailsContainer').innerHTML = '';
                if (activeBrandButton) {
                    activeBrandButton.classList.remove('active');
                    activeBrandButton = null;
                }
            };


            // --- Section for Products & Pricing Tiers (for Admin Sector View) ---
            // This function dynamically displays pricing cards for a selected sector in the admin view.
            function displaySectorSpecificProducts(sectorKey) {
                const container = document.getElementById('dynamicSectorDashboard');
                if (!container) {
                    console.error("Dynamic sector dashboard container not found!");
                    return;
                }
                container.innerHTML = ''; // Clear previous content
                document.getElementById('brandDetailsContainer').innerHTML = ''; // Also clear brand snapshot

                const sectorDispName = sectorList[sectorKey] || sectorKey.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                const sectorDataForPricing = FAA_ZONE_INDEX_SUMMARY_DATA[sectorKey];
                
                // Get brands for display in the sector view (from static + client-added)
                let brandsInSector = [...(ALL_BRANDS_DETAILS_BY_SECTOR[sectorKey] || [])];
                const clientAddedBrandsRaw = clientAdminData[sectorKey]?.brands || [];
                
                // Ensure client-added brands are also objects with name and subNodes
                const clientAddedBrandsStructured = clientAddedBrandsRaw.map(brand => {
                    // If brand is a string (from old localStorage), convert it to object. Otherwise, use as is.
                    // Ensure subNodes property exists for consistency
                    return typeof brand === 'object' && brand !== null && brand.name
                        ? { name: brand.name, subNodes: Array.isArray(brand.subNodes) ? brand.subNodes : [] }
                        : { name: brand, subNodes: [`${String(brand).slice(0,3).toUpperCase()}Node`] }; // Fallback for old string format
                });
                
                // Combine static and client-added brands, removing duplicates by name
                const combinedBrands = {};
                brandsInSector.forEach(brand => combinedBrands[brand.name] = brand);
                clientAddedBrandsStructured.forEach(brand => combinedBrands[brand.name] = brand); // Client-added overrides static if same name

                const allBrandsForDisplay = Object.values(combinedBrands);


                if (!sectorDataForPricing || allBrandsForDisplay.length === 0) {
                    container.innerHTML = `<p class="text-gray-400 col-span-full text-center mt-8">No detailed data or brands available for this sector yet.</p>`;
                    return;
                }

                // Define products (pricing tiers) for the selected sector
                const baseMonthlyFee = parseFloat(String(sectorDataForPricing.monthlyFee).replace('$', '').replace(',', ''));
                const annualDiscountRate = 0.15; // 15% discount for annual plans

                const products = [
                    {
                        name: `${sectorDispName.replace(/<.*?>/g, '')} Starter Package`,
                        monthlyAmount: baseMonthlyFee * SECTOR_TIER_PRICING.Starter.multiplier,
                        annualAmount: (baseMonthlyFee * SECTOR_TIER_PRICING.Starter.multiplier * 12 * (1 - annualDiscountRate)),
                        tier: "Starter"
                    },
                    {
                        name: `${sectorDispName.replace(/<.*?>/g, '')} Pro Package`,
                        monthlyAmount: baseMonthlyFee * SECTOR_TIER_PRICING.Pro.multiplier,
                        annualAmount: (baseMonthlyFee * SECTOR_TIER_PRICING.Pro.multiplier * 12 * (1 - annualDiscountRate)),
                        tier: "Pro", featured: true
                    },
                    {
                        name: `${sectorDispName.replace(/<.*?>/g, '')} Enterprise Package`,
                        monthlyAmount: baseMonthlyFee * SECTOR_TIER_PRICING.Enterprise.multiplier,
                        annualAmount: (baseMonthlyFee * SECTOR_TIER_PRICING.Enterprise.multiplier * 12 * (1 - annualDiscountRate)),
                        tier: "Enterprise"
                    }
                ];

                let pricingHtml = `<h2 class="text-2xl font-bold mb-6 mt-10">Pricing for ${sectorDispName}</h2><div class="grid grid-cols-1 md:grid-cols-3 gap-8">`;
                products.forEach(product => {
                    const tierInfo = SECTOR_TIER_PRICING[product.tier];
                    if (!tierInfo) return;

                    pricingHtml += `
                        <div class="col-span-1">
                            <div class="product-card p-6 md:p-8 ${product.featured ? 'featured' : ''}">
                                <div>
                                    <h3 class="text-2xl font-bold mb-4">${product.name}</h3>
                                    <p class="text-gray-400 mb-6">Unlock powerful features for ${product.tier} success.</p>
                                    
                                    <label class="toggle-switch">
                                        <input type="checkbox" onchange="window.toggleSubscriptionType(this.closest('.product-card'), this.checked)">
                                        <span class="slider">
                                            <span class="monthly-text">Monthly</span>
                                            <span class="annual-text">Annual (15% off)</span>
                                        </span>
                                    </label>

                                    <div class="mb-8">
                                        <span class="text-5xl font-extrabold ${product.featured ? 'text-blue-400' : 'text-gray-100'} price-display"
                                            data-original-monthly-price="${product.monthlyAmount.toFixed(2)}"
                                            data-original-annual-price="${product.annualAmount.toFixed(2)}"
                                            data-currency-symbol="R"
                                            data-currency-code="ZAR"> R${parseFloat(product.monthlyAmount).toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}
                                            <span class="text-xl text-gray-400">/ month</span>
                                        </span>
                                    </div>
                                    <ul class="feature-list mb-8">
                                        ${tierInfo.features.map(f => `
                                            <li><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/></svg>${f}</li>
                                        `).join('')}
                                    </ul>
                                </div>
                                <!-- PayPal button container added here -->
                                <div class="paypal-button-container"
                                    data-item-name="${product.name}"
                                    data-amount="${product.monthlyAmount.toFixed(2)}"
                                    data-item-description="Monthly subscription for ${product.name}."
                                    data-billing-cycle="MONTHLY"
                                    data-plan-key="${product.name.replace(/\s/g, '_').toLowerCase()}_monthly"
                                    >
                                    <!-- PayPal button will render here -->
                                </div>
                                <button class="buy-now-button cta-button w-full mt-4" 
                                    onclick="window.initiatePayPalSubscription(event)">
                                    Subscribe Now
                                </button>
                            </div>
                        </div>
                    `;
                });
                pricingHtml += `</div>`;
                container.innerHTML += pricingHtml;

                // Section for Tier-Specific Metrics
                let tierMetricsHtml = `<div class="admin-panel-card mt-20">
                    <h3 class="text-2xl font-bold mb-4">Tier-Specific Metrics for ${sectorDispName}</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">`;
                
                products.forEach(product => {
                    const tierMetrics = SECTOR_TIER_PRICING[product.tier].monthlyMetrics;
                    if (!tierMetrics) return;

                    tierMetricsHtml += `
                        <div class="metric-card">
                            <h4 class="font-semibold text-xl mb-2">${product.name} Metrics</h4>
                            <ul class="list-none p-0 m-0 space-y-1">
                                ${Object.entries(tierMetrics).map(([key, value]) => `
                                    <li><span class="font-medium text-gray-300">${key}:</span> <span class="text-purple-300">${value}</span></li>
                                `).join('')}
                            </ul>
                        </div>
                    `;
                });
                tierMetricsHtml += `</div></div>`;
                container.innerHTML += tierMetricsHtml;

                // Section for Brands and Subnodes (Interactive Display)
                let brandsAndSnapshotHtml = `
                    <div class="admin-panel-card mt-20">
                        <h3 class="text-2xl font-bold mb-4">Brands in ${sectorDispName}</h3>
                        <p class="mb-4 text-gray-400">Click a brand to see its detailed snapshot and associated subnodes.</p>
                        <div id="sectorBrandButtons" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-4 mb-8">
                `;

                // Add all brands (static + client-added) as buttons
                allBrandsForDisplay.forEach(brand => {
                    // Ensure brand is an object and has a name property, or assume it's a string
                    const brandNameForButton = typeof brand === 'object' && brand !== null && brand.name ? brand.name : brand;

                    brandsAndSnapshotHtml += `
                        <button class="brand-button" data-sector-key="${sectorKey}" data-brand-name="${brandNameForButton}">
                            ${brandNameForButton}
                        </button>
                    `;
                });

                brandsAndSnapshotHtml += `
                        </div>
                    </div>
                `;
                container.innerHTML += brandsAndSnapshotHtml;

                // Attach event listeners to the newly created brand buttons
                document.querySelectorAll('#sectorBrandButtons .brand-button').forEach(button => {
                    button.addEventListener('click', (event) => {
                        const clickedSectorKey = event.target.dataset.sectorKey;
                        const clickedBrandName = event.target.dataset.brandName;
                        displayBrandDetails(clickedSectorKey, clickedBrandName, event.target);
                    });
                });

                // Apply currency conversion to the newly rendered price displays
                const sectorPriceDisplays = container.querySelectorAll('.price-display');
                const sectorCurrencySelect = document.getElementById('sector-currency-select');
                if (sectorCurrencySelect && typeof window.getCurrencySymbol === 'function' && typeof window.exchangeRates !== 'undefined') {
                    updatePricesInSectorView(sectorPriceDisplays, sectorCurrencySelect.value);
                } else {
                    console.warn("Currency converter or its dependencies not fully initialized for sector view.");
                }

                // Render PayPal buttons in their new containers after products are displayed
                container.querySelectorAll('.paypal-button-container').forEach(paypalButtonContainer => {
                    const itemName = paypalButtonContainer.dataset.itemName;
                    const amount = paypalButtonContainer.dataset.amount;
                    const billingCycle = paypalButtonContainer.dataset.billingCycle;
                    const specificPlanKey = paypalButtonContainer.dataset.planKey; // This is the *logical* plan key

                    // Retrieve the single global base plan ID
                    const basePlanId = paypalPlanIDs["fruitful-global-base"];
                    
                    // If the PayPal button has NOT been rendered in this container yet, and basePlanId is available
                    const parentProductCard = paypalButtonContainer.closest('.product-card');
                    const subscribeButton = parentProductCard.querySelector('.buy-now-button');

                    if (paypalButtonContainer.children.length === 0 && basePlanId && basePlanId !== "P-YOURGLOBALBASEPLANID") {
                        paypal.Buttons({
                            createSubscription: function(data, actions) {
                                return actions.subscription.create({
                                    plan_id: basePlanId, // Use the single base plan ID
                                    custom_id: specificPlanKey // Pass the specific logical plan as custom_id
                                });
                            },
                            onApprove: function(data, actions) {
                                console.log('Subscription Approved:', data);
                                // In a real app, you would send data.subscriptionID and data.custom_id to your backend
                                // Your backend would then use data.custom_id to provision the correct service (agriculture, enterprise, monthly).
                                window.showTemporaryMessage(`Subscription for ${itemName} approved! ID: ${data.subscriptionID}. Logical Plan: ${data.custom_id || specificPlanKey}`, "success");
                            },
                            onCancel: function(data) {
                                console.log('Subscription Cancelled:', data);
                                window.showTemporaryMessage('PayPal subscription cancelled.', "info");
                                if (subscribeButton) subscribeButton.style.display = 'block'; // Show original button again
                                paypalButtonContainer.innerHTML = ''; // Clear PayPal button
                            },
                            onError: function(err) {
                                console.error('PayPal Error:', err);
                                window.showTemporaryMessage(`PayPal error: ${err.message || err}`, "error");
                                if (subscribeButton) subscribeButton.style.display = 'block'; // Show original button again
                                paypalButtonContainer.innerHTML = ''; // Clear PayPal button
                            }
                        }).render(paypalButtonContainer); // Render into the dedicated container
                    } else if (!basePlanId || basePlanId === "P-YOURGLOBALBASEPLANID") {
                         // If no valid base plan ID, disable the original subscribe button
                         if (subscribeButton) {
                            subscribeButton.textContent = "Plan Unavailable";
                            subscribeButton.disabled = true;
                            subscribeButton.classList.remove('cta-button'); // Remove styling
                            subscribeButton.style.backgroundColor = 'gray'; // Add gray background
                            subscribeButton.style.cursor = 'not-allowed';
                            // Show a specific warning for this product card if its base plan ID is missing
                            console.warn(`PayPal Subscription for ${itemName} (${specificPlanKey}) is unavailable: Base Plan ID is a placeholder or missing.`);
                         }
                         // The global message about the base plan ID missing will be shown on load by fetchPayPalPlanIDs
                    }
                });
            }


            // --- Global Metrics & Chart Functions ---
            // _currentGlobalMetrics is declared here as a property of the window object to prevent redeclaration errors
            // if the script is inadvertently loaded or executed multiple times in the same global context.
            window._currentGlobalMetrics = { 
                activeNodes: 0, licensesActive: 0, vaultDeployments: 0, 
                syncLogs: 0, auditsRunning: 0, signalZones: 0, scrollGridIndex: 0
            };

            function calculateGlobalMetrics() {
                let tempActiveNodes = 0;
                let tempLicensesActive = 0;
                let tempVaultDeployments = 0;
                let tempSyncLogs = 0;
                let tempAuditsRunning = 0;
                let tempSignalZones = 0;
                let tempScrollGridIndex = 0;

                for (const sectorKey in sectorList) {
                    if (sectorKey === 'admin-panel') continue; 

                    // Get static brands and their subnodes
                    const staticBrandsInSector = ALL_BRANDS_DETAILS_BY_SECTOR[sectorKey] || [];
                    const staticBrandsCount = staticBrandsInSector.length;
                    const staticNodesCount = staticBrandsInSector.flatMap(brand => Array.isArray(brand.subNodes) ? brand.subNodes : []).length;
                    
                    // Get client-added brands and their subnodes
                    const adminData = clientAdminData[sectorKey];
                    const adminAddedBrands = adminData?.brands || [];
                    const adminAddedBrandsCount = adminAddedBrands.length;
                    // --- FIX for Issue #3: Ensure subNodes are correctly accessed and are arrays ---
                    const adminAddedNodesCount = adminAddedBrands.flatMap(brand => Array.isArray(brand.subNodes) ? brand.subNodes : []).length; 

                    const totalCoreBrands = staticBrandsCount + adminAddedBrandsCount;
                    const totalNodes = staticNodesCount + adminAddedNodesCount;
                    
                    tempActiveNodes += totalCoreBrands; 
                    tempLicensesActive += totalCoreBrands * 2; 
                    tempVaultDeployments += totalCoreBrands * 1.5; 
                    tempSyncLogs += totalCoreBrands * 5; 
                    tempAuditsRunning += Math.ceil(totalCoreBrands / 10); 
                    tempSignalZones += Math.floor(totalCoreBrands / 3); 
                    tempScrollGridIndex += (totalCoreBrands + totalNodes);
                }
                
                window._currentGlobalMetrics.activeNodes = tempActiveNodes;
                window._currentGlobalMetrics.licensesActive = tempLicensesActive;
                window._currentGlobalMetrics.vaultDeployments = Math.round(tempVaultDeployments);
                window._currentGlobalMetrics.syncLogs = tempSyncLogs;
                window._currentGlobalMetrics.auditsRunning = tempAuditsRunning;
                window._currentGlobalMetrics.signalZones = tempSignalZones;
                window._currentGlobalMetrics.scrollGridIndex = tempScrollGridIndex;

                document.getElementById("activeNodesCount").textContent = window._currentGlobalMetrics.activeNodes.toLocaleString();
                document.getElementById("licensesActiveCount").textContent = window._currentGlobalMetrics.licensesActive.toLocaleString();
                document.getElementById("vaultDeploymentsCount").textContent = window._currentGlobalMetrics.vaultDeployments.toLocaleString();
                document.getElementById("syncLogsCount").textContent = window._currentGlobalMetrics.syncLogs.toLocaleString();
                // Ensure these elements exist in your HTML if you want them updated
                const auditsRunningEl = document.getElementById("auditsRunningCount");
                if(auditsRunningEl) auditsRunningEl.textContent = window._currentGlobalMetrics.auditsRunning.toLocaleString(); 
                const signalZonesEl = document.getElementById("signalZonesCount");
                if(signalZonesEl) signalZonesEl.textContent = window._currentGlobalMetrics.signalZones.toLocaleString(); 
                const scrollGridIndexEl = document.getElementById("scrollGridIndexCount");
                if(scrollGridIndexEl) scrollGridIndexEl.textContent = window._currentGlobalMetrics.scrollGridIndex.toLocaleString(); 
            }


            // --- Dynamic Pulse Chart ---
            let pulseChartInstance = null; 
            const chartTimeLabels = Array.from({ length: 10 }, (_, i) => `T-${(9-i)*3}s`); 
            chartTimeLabels[9] = "Now";

            const chartDataPoints = {
                activeNodes: Array(10).fill(0),
                licensesActive: Array(10).fill(0),
                vaultDeployments: Array(10).fill(0)
            };

            function renderDynamicPulseChart() {
                const ctxEl = document.getElementById("pulseChart");
                if (!ctxEl) {
                    console.error("Canvas element for pulseChart not found!");
                    return;
                }
                const ctx = ctxEl.getContext("2d");

                if (pulseChartInstance) {
                    pulseChartInstance.destroy();
                }
                
                calculateGlobalMetrics(); 
                // Initialize chart data points with current metrics, then simulate changes
                chartDataPoints.activeNodes = Array(10).fill(window._currentGlobalMetrics.activeNodes);
                chartDataPoints.licensesActive = Array(10).fill(window._currentGlobalMetrics.licensesActive);
                chartDataPoints.vaultDeployments = Array(10).fill(window._currentGlobalMetrics.vaultDeployments);


                pulseChartInstance = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: [...chartTimeLabels], 
                        datasets: [
                            {
                                label: 'Active Nodes',
                                data: [...chartDataPoints.activeNodes],
                                borderColor: '#60A5FA', // Light Blue
                                backgroundColor: 'rgba(96, 165, 250, 0.1)',
                                borderWidth: 2, tension: 0.3, fill: true, pointRadius: 2, pointHoverRadius: 4
                            },
                            {
                                label: 'Licenses Active',
                                data: [...chartDataPoints.licensesActive],
                                borderColor: '#34D399', // Emerald Green
                                backgroundColor: 'rgba(52, 211, 153, 0.1)',
                                borderWidth: 2, tension: 0.3, fill: true, pointRadius: 2, pointHoverRadius: 4
                            },
                            {
                                label: 'Vault Deployments',
                                data: [...chartDataPoints.vaultDeployments],
                                borderColor: '#FCD34D', // Amber Yellow
                                backgroundColor: 'rgba(252, 211, 77, 0.1)',
                                borderWidth: 2, tension: 0.3, fill: true, pointRadius: 2, pointHoverRadius: 4
                            }
                        ]
                    },
                    options: { 
                        responsive: true, 
                        maintainAspectRatio: false, 
                        animation: { duration: 500 }, 
                        plugins: { 
                            legend: { display: true, position: 'top', labels: { color: "#C0C0C0" } },
                            tooltip: { mode: 'index', intersect: false }
                        }, 
                        scales: { 
                            y: { beginAtZero: true, ticks: { color: "#A0A0A0" }, title: { display: true, text: 'Count', color: '#C0C0C0'} }, 
                            x: { ticks: { color: "#A0A0A0" }, title: {display: true, text: 'Time (Updates every 3s)', color: '#C0C0C0'} } 
                        } 
                    }
                });
            }

            function updateDynamicPulseChart() {
                if (!pulseChartInstance) return;
                
                calculateGlobalMetrics(); // Ensure _currentGlobalMetrics is up-to-date

                chartDataPoints.activeNodes.shift();
                chartDataPoints.licensesActive.shift();
                chartDataPoints.vaultDeployments.shift();

                chartDataPoints.activeNodes.push(window._currentGlobalMetrics.activeNodes + (Math.random() * 100 - 50)); // Add some variance
                chartDataPoints.licensesActive.push(window._currentGlobalMetrics.licensesActive + (Math.random() * 20 - 10));
                chartDataPoints.vaultDeployments.push(window._currentGlobalMetrics.vaultDeployments + (Math.random() * 5 - 2));
                
                pulseChartInstance.data.datasets[0].data = [...chartDataPoints.activeNodes];
                pulseChartInstance.data.datasets[1].data = [...chartDataPoints.licensesActive];
                pulseChartInstance.data.datasets[2].data = [...chartDataPoints.vaultDeployments];
                
                pulseChartInstance.update();
            }

            // --- FAA.ZONE INDEX Table Renderer ---
            function renderFaaZoneIndexTable() {
                const tableBody = document.getElementById("faaZoneIndexTableBody");
                if (!tableBody) {
                    console.error("FAA Zone Index table body not found.");
                    return;
                }
                tableBody.innerHTML = ''; // Clear existing content

                const sectorsToDisplay = Object.keys(FAA_ZONE_INDEX_SUMMARY_DATA);
                
                sectorsToDisplay.sort((a, b) => {
                    const nameA = sectorList[a] || a;
                    const nameB = sectorList[b] || b;
                    return nameA.localeCompare(nameB);
                });

                sectorsToDisplay.forEach(sectorKey => {
                    const summary = FAA_ZONE_INDEX_SUMMARY_DATA[sectorKey];
                    if (!summary) { // Check if summary data exists for this sectorKey
                        console.warn(`Summary data missing for sector: ${sectorKey} in FAA_ZONE_INDEX_SUMMARY_DATA`);
                        return; // Skip this sector if no summary data
                    }
                    const displayName = sectorList[sectorKey] || sectorKey.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase());

                    const staticBrandsForCount = ALL_BRANDS_DETAILS_BY_SECTOR[sectorKey] || [];
                    const staticBrandsCount = staticBrandsForCount.length;
                    const staticNodesCount = staticBrandsForCount.flatMap(brand => Array.isArray(brand.subNodes) ? brand.subNodes : []).length;
                    
                    const adminData = clientAdminData[sectorKey];
                    const adminAddedBrands = adminData?.brands || [];
                    const adminAddedBrandsCount = adminAddedBrands.length;
                    // --- FIX for Issue #3: Ensure subNodes are correctly accessed and are arrays ---
                    const adminAddedNodesCount = adminAddedBrands.flatMap(brand => Array.isArray(brand.subNodes) ? brand.subNodes : []).length; 

                    const totalCoreBrands = staticBrandsCount + adminAddedBrandsCount;
                    const totalNodes = staticNodesCount + adminAddedNodesCount;

                    const row = tableBody.insertRow();
                    row.className = 'table-row-style'; // Apply the defined row style
                    
                    row.innerHTML = `
                        <td class="table-cell-padding text-xl">${summary.glyph}</td>
                        <td class="table-cell-padding font-semibold">${displayName}</td>
                        <td class="table-cell-padding">${totalCoreBrands}</td>
                        <td class="table-cell-padding">${totalNodes}</td>
                        <td class="table-cell-padding">R${parseFloat(summary.monthlyFee).toFixed(2)}</td>
                        <td class="table-cell-padding">R${parseFloat(summary.annualFee).toFixed(2)}</td>
                        <td class="table-cell-padding">${summary.payoutTier}</td>
                        <td class="table-cell-padding">${summary.region}</td>
                        <td class="table-cell-padding">
                            <button class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-xs inspect-button"
                                data-sector-key="${sectorKey}" data-action="inspect">
                                Inspect
                            </button>
                        </td>
                        <td class="table-cell-padding">
                            <button class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-xs deploy-button"
                                data-sector-key="${sectorKey}" data-action="deploy">
                                Deploy Plan
                            </button>
                        </td>
                    `;
                });

                // Attach event listeners to the new Inspect and Deploy buttons
                document.querySelectorAll('#faaZoneIndexTableBody .inspect-button').forEach(button => {
                    button.addEventListener('click', (event) => {
                        const sectorKey = event.target.dataset.sectorKey;
                        
                        // Find the corresponding navigation link and simulate a click
                        const navLink = document.querySelector(`.admin-nav-scroll a[data-section="sector-view-section"]`);
                        if (navLink) {
                            showAdminSection('sector-view-section', navLink);
                            // Set the dropdown to the correct sector
                            const sectorViewSelect = document.getElementById('sectorViewSelect');
                            sectorViewSelect.value = sectorKey;
                            // Then display the products for that sector
                            displaySectorSpecificProducts(sectorKey);
                        }
                    });
                });

                 document.querySelectorAll('#faaZoneIndexTableBody .deploy-button').forEach(button => {
                    button.addEventListener('click', (event) => {
                        const sectorKey = event.target.dataset.sectorKey;
                        // This "Deploy Plan" action is now purely illustrative, simulating a backend process.
                        window.showTemporaryMessage(`Simulating backend deployment for ${sectorKey}. (No PayPal redirect from here).`, "info");
                        console.log(`Backend would now create/configure PayPal plans for ${sectorKey} if needed, using the single base plan logic.`);
                    });
                });
            }

            // --- PayPal Integration Functions ---
            // These functions would interact with your backend to create/manage PayPal subscriptions.
            // For now, they are mock implementations.

            // This function would typically be an API call to your backend
            // which then calls PayPal's API to get existing Plan IDs or create new ones.
            window.fetchPayPalPlanIDs = async function() {
                console.log("Fetching PayPal Plan IDs...");
                window.showTemporaryMessage("Fetching PayPal Plan IDs (mock data)...", "info");
                // Simulate an API call delay
                await new Promise(resolve => setTimeout(resolve, 1000)); 
                
                // In a real application, you'd fetch real IDs from your backend like this:
                /*
                try {
                    const response = await fetch('/api/paypal/plans');
                    if (!response.ok) throw new Error('Failed to fetch PayPal plans from backend.');
                    const data = await response.json();
                    Object.assign(paypalPlanIDs, data); // Merge fetched IDs
                    console.log("PayPal Plan IDs fetched:", paypalPlanIDs);
                } catch (error) {
                    console.error("Error fetching PayPal Plan IDs:", error);
                    window.showTemporaryMessage("Error fetching PayPal plans. Check backend.", "error");
                }
                */
                console.log("Mock PayPal Plan IDs loaded.");
            };


            // This function would be triggered by the "Subscribe Now" button in the Sector View
            window.initiatePayPalSubscription = function(event) {
                const originalButton = event.target;
                const cardElement = originalButton.closest('.product-card');
                const paypalContainer = cardElement.querySelector('.paypal-button-container');

                const itemName = paypalContainer.dataset.itemName;
                const amount = paypalContainer.dataset.amount;
                const billingCycle = paypalContainer.dataset.billingCycle;
                const specificPlanKey = paypalContainer.dataset.planKey; // This is the *logical* plan key

                console.log(`Initiating PayPal subscription for: ${itemName}, Amount: ${amount}, Cycle: ${billingCycle}, Logical Plan Key: ${specificPlanKey}`);
                window.showTemporaryMessage(`Preparing PayPal subscription for ${itemName}...`, "info");

                // Retrieve the single global base plan ID
                const basePlanId = paypalPlanIDs["fruitful-global-base"];

                if (!basePlanId || basePlanId === "P-YOURGLOBALBASEPLANID") {
                    window.showTemporaryMessage(`PayPal Base Plan ID "fruitful-global-base" is a placeholder. Please configure a real ID to proceed.`, "error");
                    console.error(`Missing PayPal Base Plan ID for: "fruitful-global-base"`);
                    // Ensure the original button is re-enabled or shows appropriate status
                    if (originalButton) {
                        originalButton.textContent = "Plan Config Error";
                        originalButton.disabled = true;
                        originalButton.classList.remove('cta-button'); 
                        originalButton.style.backgroundColor = '#cc2222'; // Darker red for config error
                        originalButton.style.cursor = 'not-allowed';
                    }
                    return;
                }
                
                // Hide the original button and render PayPal button in its container
                originalButton.style.display = 'none'; // Hide the original "Subscribe Now" button
                paypalContainer.innerHTML = ''; // Clear any previous content in the container

                paypal.Buttons({
                    createSubscription: function(data, actions) {
                        return actions.subscription.create({
                            plan_id: basePlanId, // Use the single base plan ID
                            custom_id: specificPlanKey, // Pass the specific logical plan as custom_id
                            // This `custom_id` will be sent to your backend via PayPal's webhook on approval.
                            // Your backend will then use this to identify the specific service to provision.
                        });
                    },
                    onApprove: function(data, actions) {
                        console.log('Subscription Approved:', data);
                        // In a real app, you would send data.subscriptionID and data.custom_id to your backend
                        // Your backend would then use data.custom_id to provision the correct service (agriculture, enterprise, monthly).
                        window.showTemporaryMessage(`Subscription for ${itemName} approved! ID: ${data.subscriptionID}. Logical Plan: ${data.custom_id || specificPlanKey}`, "success");
                    },
                    onCancel: function(data) {
                        console.log('Subscription Cancelled:', data);
                        window.showTemporaryMessage('PayPal subscription cancelled.', "info");
                        if (originalButton) originalButton.style.display = 'block'; // Show original button again
                        paypalContainer.innerHTML = ''; // Clear PayPal button
                    },
                    onError: function(err) {
                        console.error('PayPal Error:', err);
                        window.showTemporaryMessage(`PayPal error: ${err.message || err}`, "error");
                        if (originalButton) originalButton.style.display = 'block'; // Show original button again
                        paypalContainer.innerHTML = ''; // Clear PayPal button
                    }
                }).render(paypalContainer); // Render into the dedicated container
            };

            // --- Currency Converter Logic ---
            window.fetchExchangeRates = async function() { // Made global
                const selectElement = document.getElementById('sector-currency-select');

                if (API_KEY === "YOUR_EXCHANGE_RATE_API_KEY" || API_KEY === "") {
                    if (!apiKeyWarningShown) { // Only show this warning once
                        window.showTemporaryMessage('Currency converter API key is missing. Please set it up for currency conversion to work.', 'error');
                        apiKeyWarningShown = true;
                    }
                    if (selectElement) selectElement.disabled = true;
                    console.warn("Currency converter: API_KEY is missing. Please get your API key from https://www.exchangerate-api.com/ and replace 'YOUR_EXCHANGE_RATE_API_KEY' in the code. Currency conversion will not work without it.");
                    return;
                }
                try {
                    const response = await fetch(`https://v6.exchangerate-api.com/v6/${API_KEY}/latest/${BASE_CURRENCY}`);
                    if (!response.ok) {
                        const errorData = await response.json();
                        const errorMessage = `Could not fetch exchange rates: ${errorData['error-type'] || 'Unknown error.'}`;
                        window.showTemporaryMessage(errorMessage, 'error');
                        throw new Error(`HTTP error! Status: ${response.status}. API Error: ${errorData['error-type'] || 'Unknown error.'}`);
                    }
                    const data = await response.json();
                    if (data && data.conversion_rates) {
                        exchangeRates = data.conversion_rates;
                        console.log('Admin: Exchange rates fetched:', exchangeRates);
                    } else {
                        window.showTemporaryMessage('Could not fetch exchange rates: Unexpected API response structure.', 'error');
                        console.error('Admin: Failed to fetch conversion rates: Unexpected API response structure.', data);
                        if (selectElement) selectElement.disabled = true;
                    }
                } catch (error) {
                    window.showTemporaryMessage(`Error fetching exchange rates: ${error.message}. Check console.`, 'error');
                    console.error('Admin: Error fetching exchange rates:', error.message || error);
                    if (selectElement) selectElement.disabled = true;
                }
            }

            window.getCurrencySymbol = function(currencyCode) { // Made global
                switch (currencyCode) {
                    case 'USD': return '$';
                    case 'EUR': return '€';
                    case 'GBP': return '£';
                    case 'ZAR': return 'R';
                    default: return currencyCode;
                }
            }
            
            // Function to update prices in the Sector View dynamically
            function updatePricesInSectorView(priceSpans, selectedCurrency) {
                const selectedSymbol = getCurrencySymbol(selectedCurrency);
                priceSpans.forEach(priceSpan => {
                    // Determine if currently displaying annual or monthly based on the toggle state
                    const cardElement = priceSpan.closest('.product-card');
                    const toggleCheckbox = cardElement ? cardElement.querySelector('.toggle-switch input[type="checkbox"]') : null;
                    const isAnnualDisplayed = toggleCheckbox ? toggleCheckbox.checked : false; // Default to monthly if no toggle or unchecked

                    const originalPriceValue = isAnnualDisplayed ? parseFloat(priceSpan.dataset.originalAnnualPrice) : parseFloat(priceSpan.dataset.originalMonthlyPrice);
                    let convertedPrice = originalPriceValue;

                    if (selectedCurrency !== BASE_CURRENCY && exchangeRates[selectedCurrency]) {
                        convertedPrice = originalPriceValue * exchangeRates[selectedCurrency];
                    }
                    // Retain the / month or / year suffix
                    const suffix = isAnnualDisplayed ? '/ year' : '/ month';
                    priceSpan.innerHTML = `${selectedSymbol}${convertedPrice.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})} <span class="text-xl text-gray-400">${suffix}</span>`;
                    priceSpan.dataset.currencyCode = selectedCurrency;

                    // Update the dataset.amount and planKey for the PayPal button container
                    const paypalContainer = cardElement ? cardElement.querySelector('.paypal-button-container') : null;
                    if (paypalContainer) {
                        paypalContainer.dataset.amount = convertedPrice.toFixed(2);
                        const itemName = paypalContainer.dataset.itemName; // Get item name from its own dataset
                        const basePlanKey = itemName.replace(/\s/g, '_').toLowerCase(); // Sanitize
                        paypalContainer.dataset.planKey = `${basePlanKey}_${isAnnualDisplayed ? 'annual' : 'monthly'}`;
                        paypalContainer.dataset.billingCycle = isAnnualDisplayed ? 'ANNUAL' : 'MONTHLY';

                        // IMPORTANT: Re-rendering PayPal buttons on currency/toggle change is complex.
                        // The PayPal SDK expects to be rendered once. Dynamically changing plan_id on a rendered button
                        // is not directly supported. For this mock, simply updating dataset is illustrative.
                        // In a real app, you might need to destroy and re-create the PayPal button,
                        // or handle the price change in a way that doesn't rely on button re-render.
                        // For now, if the PayPal button is already rendered, we don't touch it.
                        // A user would have to click the "Subscribe Now" button again to pick up the new price.
                        // Or, simpler for this demo, we re-trigger the rendering of products when currency changes
                        // which rebuilds the PayPal buttons.
                    }
                });
            }

            // --- DOMContentLoaded Initialization ---
            document.addEventListener('DOMContentLoaded', async () => {
                populateSectorSelect();
                populateSectorViewSelect(); // Populate for the sector view dropdown
                
                await window.fetchPayPalPlanIDs(); // Await fetching PayPal Plan IDs on load
                await window.fetchExchangeRates(); // Await fetching exchange rates on load

                // Attach event listeners for main navigation
                document.querySelectorAll('.admin-nav-link').forEach(link => {
                    link.addEventListener('click', (event) => {
                        event.preventDefault(); // Prevent default link behavior
                        const sectionId = event.target.dataset.section;
                        window.showAdminSection(sectionId, event.target);
                    });
                });

                // Manually trigger the initial active section
                const initialNavLink = document.querySelector('.admin-nav-link[data-section="add-brand-section"]');
                if (initialNavLink) {
                    window.showAdminSection('add-brand-section', initialNavLink);
                }

                // Attach event listener for add brand button
                document.getElementById('addBrandBtn').addEventListener('click', addBrandToSector);
                // Attach event listener for clear admin data button
                document.getElementById('clearAdminDataBtn').addEventListener('click', clearAdminAddedData);

                // Add event listener for currency select in sector view
                const sectorCurrencySelect = document.getElementById('sector-currency-select');
                if (sectorCurrencySelect) {
                    sectorCurrencySelect.addEventListener('change', (event) => {
                        const selectedCurrency = event.target.value;
                        const sectorViewSelect = document.getElementById('sectorViewSelect'); // Get current selected sector in view
                        // Re-render the current sector view to apply new currency and re-initialize PayPal buttons
                        if (sectorViewSelect && sectorViewSelect.value) {
                             displaySectorSpecificProducts(sectorViewSelect.value);
                        }
                    });
                }

                // Initialize metrics and chart
                calculateGlobalMetrics();
                renderDynamicPulseChart();
                // Store interval ID globally to clear it later if needed
                window._pulseChartInterval = setInterval(updateDynamicPulseChart, 3000); 

                // loadMainDashboardData(); // This was causing console errors as brandDashboard element is not in this HTML.
            });

        })(); // End of IIFE
    </script>
</body>
</html>
